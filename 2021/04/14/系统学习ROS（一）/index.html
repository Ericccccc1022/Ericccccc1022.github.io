
<!DOCTYPE html>
<html lang="en">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Eric Tan">
    <title>系统学习ROS（一） - Eric Tan</title>
    <meta name="author" content="Eric Tan">
    
    
    
    <script type="application/ld+json">{"@context":"http://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Eric Tan","sameAs":["https://github.com/","http://stackoverflow.com/users","https://twitter.com/","https://facebook.com/","https://plus.google.com/","https://www.linkedin.com/profile/","mailto"]},"articleBody":"入门的概念已经了解，本系列是我在系统学习ROS中的笔记。ROS知识点繁多，有些内容用到的时候google或者wiki查询，不做记录。\n\n\n同时，只记录python实现版本。\n学习地址（全文参考）：http://www.autolabor.com.cn/book/ROSTutorials/\n一、基础知识1.基本开发流程\n创建工作空间；\n创建功能包；\n编辑源文件；（.cpp、.py）\n编辑配置文件；\n编译并执行。\n\n2.workspace以及功能包的编译与使用（1）创建workspace：\n123mkdir -p test_ws&#x2F;srccd test_wscatkin_make  #编译工作空间\n\n（2）创建功能包：\n12cd srccatkin_create_pkg &lt;depend&gt; roscpp rospy std_msgs  # 通常都需要roscpp、rospy\n\n\n\n学习过程中：\nubuntu工作空间创建好后，可以一直用；例如创建了test_ws工作空间，该空间已经编译完成，有自动生成的devel、build文件夹，则后续可以在该workspace下添加功能包。\n在src文件夹下：有多个功能包，在学习过程中直接将源码功能包放进来;\n编译功能包：\n123#在根目录下catkin_makesource devel&#x2F;setup.bash   #此命令只对当前终端有效，要想一劳永逸，见下面方法\n\n然后就可以roslaunch执行launch文件啦！\n12345678#方法一直接使用 gedit 或 vi 编辑 .bashrc 文件，最后添加该内容#方法二echo &quot;source ~&#x2F;工作空间&#x2F;devel&#x2F;setup.bash&quot; &gt;&gt; ~&#x2F;.bashrc最后在终端中执行：source .bashrc  #之后在所有终端中都可以一劳永逸了！\n\n\n\n3.集成开发环境：选择VS Code，有了集成开发环境，可以不用再在记事本当中写代码了！\n（1）集成开发环境提供了图形化界面，可以可视化地创建功能包、程序文件等；\n（2）为VScode安装如下插件：C++、Python、Cmake、ROS\n（3）进行一些配置，将作者的配置文件直接复制，此后可以通过Ctrl+Shift+B直接完成编译（相当与catkin_make）\n（4）无论是C++还是python程序，都需要在CMakeList文件中做配置，再编译；\n4.launch文件12345678910111213&lt;launch&gt;    &lt;node pkg&#x3D;&quot;helloworld&quot; type&#x3D;&quot;demo_hello&quot; name&#x3D;&quot;hello&quot; output&#x3D;&quot;screen&quot; &#x2F;&gt;    &lt;node pkg&#x3D;&quot;turtlesim&quot; type&#x3D;&quot;turtlesim_node&quot; name&#x3D;&quot;t1&quot;&#x2F;&gt;    &lt;node pkg&#x3D;&quot;turtlesim&quot; type&#x3D;&quot;turtle_teleop_key&quot; name&#x3D;&quot;key1&quot; &#x2F;&gt;&lt;&#x2F;launch&gt;roslaunch 包名 launch文件名# node ---&gt; 包含的某个节点# pkg -----&gt; 功能包# type ----&gt; 被运行的节点文件# name --&gt; 为节点命名# output-&gt; 设置日志的输出目标\n\n\n\n5.文件系统架构：\n\n经常编辑这些功能包就会熟悉起来\n6.ROS文件系统常用命令ROS专门提供了一些类似于Linux的命令：\n123456sudo apt install xxx   #安装 ROS功能包sudo apt purge xxx    #删除某个功能包rospack list   #列出所有功能包rospack find 包名   #查找某个功能包是否存在，如果存在返回安装路径apt search xxx    # 在网上搜索某个功能包\n\n\n\n7.ROS计算图rqt_graph能够创建一个显示当前系统运行情况的动态图形\n1rqt_graph\n\n\n\n\n\n二、话题通信话题通信是基于发布订阅模式的，也即:一个节点发布消息，另一个节点订阅该消息。\n例如：机器人在执行导航功能，使用的传感器是激光雷达，机器人会采集激光雷达感知到的信息并计算，然后生成运动控制信息驱动机器人底盘运动。\n上述过程涉及多次话题通信：\n（1）以激光雷达信息的采集处理为例，在 ROS 中有一个节点需要时时的发布当前雷达采集到的数据，导航模块中也有节点会订阅并解析雷达数据；\n（2）再以运动消息的发布为例，导航模块会根据传感器采集的数据时时的计算出运动控制信息并发布给底盘，底盘也可以有一个节点订阅运动信息并最终转换成控制电机的脉冲信号；\n以此类推，像雷达、摄像头、GPS…. 等等一些传感器数据的采集，也都是使用了话题通信，换言之，话题通信适用于不断更新的、少逻辑处理的数据传输相关的应用场景。\n1.C++\n12345#在订阅者实现中：ros : : spin( )     # 回调函数：处理订阅的数据#发布者需要等待回调函数：ros : : spinOnce( ) \n\n2.python实现：（发布最简单的hello信息）\n123456789101112131415161718192021222324#Publisher#1.导包 import rospyfrom std_msgs.msg import String    #发布消息的类型if __name__ == &quot;__main__&quot;:    #2.初始化 ROS 节点:命名(唯一)    rospy.init_node(&quot;talker_p&quot;)      #直接传入节点名称        #3.实例化 发布者 对象    pub = rospy.Publisher(&quot;chatter&quot;,String,queue_size=10)  #话题名称、消息类型、缓存队列长度        #4.组织被发布的数据，并编写逻辑发布数据    msg = String()  #创建 msg 对象        # 设置循环频率    rate = rospy.Rate(1)   # 1Hz        while not rospy.is_shutdown():   #使用rospy中的函数，判断节点没有关闭        msg.data = &quot;hello&quot;   #定义发布的消息        pub.publish(msg)        rate.sleep()  #每隔rate秒醒过来        rospy.loginfo(&quot;发布的数据是:%s&quot;,msg.data）\n\n123456789#编译python文件流程：(以配置好的VS Code为例)          以后所有运行的python程序都要经过这一步1.终端添加可执行权限：chmod  +x  *.py2.修改CmakeList文件：    catkin_install_python(PROGRAMS        scripts/demo_pubpy.py        DESTINATION $&#123;CATKIN_PACKAGE_BIN_DESTINATION&#125;         )3. Ctrl+Shift+B编译4. roscore+rosrun运行即可\n\n12345678910111213141516171819#Subscriber#1.导包 import rospyfrom std_msgs.msg import Stringdef doMsg(msg):  #定义回调函数    rospy.loginfo(&quot;我订阅的数据：%s&quot;,msg.data)if __name__ == &quot;__main__&quot;:    #2.初始化 ROS 节点:命名(唯一)    rospy.init_node(&quot;listener_p&quot;)        #3.实例化 订阅者 对象    sub = rospy.Subscriber(&quot;chatter&quot;,String, doMsg, queue_size=10)  #话题名称、消息类型、回调函数、队列长度        #4.处理订阅的消息(回调函数)    #5.设置循环调用回调函数    rospy.spin()\n\n\n\n3.自定义消息\nROS 中通过 std_msgs 封装了一些原生的数据类型,比如:String、Int32、Int64、Char、Bool、Empty…. 但是，这些数据一般只包含一个 data 字段—&gt;用于接受消息\n应用场景：传递一些复杂数据时\n\n流程：\n\n（1）定义msg文件：功能包下新建 msg 目录，添加文件 Person.msg\n123string nameuint16 agefloat64 height\n\n（2）编辑配置文件package.xml\n12&lt;build_depend&gt;message_generation&lt;/build_depend&gt;   #message_generation&lt;exec_depend&gt;message_runtime&lt;/exec_depend&gt;   #message_runtime\n\n（3）CMakeLists.txt编辑 msg 相关配置\n12345678910111213141516171819202122232425find_package(catkin REQUIRED COMPONENTS  roscpp  rospy  std_msgs  message_generation)# 需要加入 message_generation,必须有 std_msgsadd_message_files(  FILES  Person.msg)generate_messages(  DEPENDENCIES  std_msgs)#执行时依赖catkin_package(#  INCLUDE_DIRS include#  LIBRARIES demo02_talker_listener  CATKIN_DEPENDS roscpp rospy std_msgs message_runtime#  DEPENDS system_lib)\n\n\npython实现发布、订阅自定义消息\n\n1234567891011121314151617181920212223#Publisher发布自定义的Person类型消息import rospyfrom demo02_talker_listener.msg import Person  #自定义的消息类型文件if __name__ == &quot;__main__&quot;:    #1.初始化 ROS 节点    rospy.init_node(&quot;talker_person_p&quot;)    #2.创建发布者对象    pub = rospy.Publisher(&quot;chatter_person&quot;,Person,queue_size=10)    #3.组织消息  （自定义的Person类型）    p = Person()    p.name = &quot;葫芦瓦&quot;    p.age = 18    p.height = 0.75    #4.编写消息发布逻辑    rate = rospy.Rate(1)    while not rospy.is_shutdown():        pub.publish(p)  #发布消息        rate.sleep()  #休眠        rospy.loginfo(&quot;姓名:%s, 年龄:%d, 身高:%.2f&quot;,p.name, p.age, p.height)\n\n123456789101112131415#Subscriber订阅自定义的Person类型消息import rospyfrom demo02_talker_listener.msg import Persondef doPerson(p):  #定义回调函数    rospy.loginfo(&quot;接收到的人的信息:%s, %d, %.2f&quot;,p.name, p.age, p.height)if __name__ == &quot;__main__&quot;:    #1.初始化节点    rospy.init_node(&quot;listener_person_p&quot;)    #2.创建订阅者对象    sub = rospy.Subscriber(&quot;chatter_person&quot;,Person, doPerson, queue_size=10)    rospy.spin() #4.循环\n\n\n\n三、服务通信无论是话题还是服务通信，都是以来于话题的！\n基于请求响应模式，适用于对时时性有要求、具有一定逻辑处理的应用场景。\nROS Master 负责保管 Server 和 Client 注册的信息，并匹配话题相同的 Server 与 Client ，帮助 Server 与 Client 建立连接，连接建立后，Client 发送请求信息，Server 返回响应信息。\n对时序有严格要求：客户端发起请求时，必须保证服务端已经启动。\n1.自定义服务消息类型srv文件：\n功能包下新建 srv 目录，添加 xxx.srv 文件，内容:\n1234567# 客户端请求时发送的两个数字int32 num1int32 num2---                                                       #在 srv 文件中请求和响应使用---分割# 服务器响应发送的数据int32 sum\n\n编辑配置文件\n1234567#package.xml  &lt;build_depend&gt;message_generation&lt;/build_depend&gt;  &lt;exec_depend&gt;message_runtime&lt;/exec_depend&gt;  &lt;!--   exce_depend 以前对应的是 run_depend 现在非法  --&gt;\n\n12345678910111213141516171819#CMakeListfind_package(catkin REQUIRED COMPONENTS  roscpp  rospy  std_msgs  message_generation)# 需要加入 message_generation,必须有 std_msgsadd_service_files(  FILES  AddInts.srv)generate_messages(  DEPENDENCIES  std_msgs)\n\n2.Server、Client的python实现\n12345678910111213141516171819202122232425262728#Server ： 解析客户端请求，产生响应# 1.导包import rospyfrom demo03_server_client.srv import AddInts,AddIntsRequest,AddIntsResponse# 回调函数的参数是请求对象，返回值是响应对象def doReq(req):    # 解析提交的数据    sum = req.num1 + req.num2    rospy.loginfo(&quot;提交的数据:num1 = %d, num2 = %d, sum = %d&quot;,req.num1, req.num2, sum)    #将结果封装进响应    # 创建响应对象，赋值并返回    # resp = AddIntsResponse()    # resp.sum = sum    resp = AddIntsResponse(sum)    return resp if __name__ == &quot;__main__&quot;:    # 2.初始化 ROS 节点    rospy.init_node(&quot;addints_server_p&quot;)    # 3.创建服务对象    server = rospy.Service(&quot;AddInts&quot;,AddInts,doReq)    #话题名称，消息类型，回调函数    # 4.回调函数处理请求并产生响应    # 5.spin 函数    rospy.spin()\n\n123456789101112131415161718192021222324252627282930313233343536373839404142#Client：#1.导包import rospyfrom demo03_server_client.srv import *import sysif __name__ == &quot;__main__&quot;:    #优化实现    if len(sys.argv) != 3:    #判断动态传入的参数是否为3个        rospy.logerr(&quot;请正确提交参数&quot;)        sys.exit(1)    # 2.初始化 ROS 节点    rospy.init_node(&quot;AddInts_Client_p&quot;)    # 3.创建Client对象    client = rospy.ServiceProxy(&quot;AddInts&quot;,AddInts)   #话题名称、消息类型        # 请求前，等待服务已经就绪：防止启动顺序出错（鲁棒性设置）    # 方式1:     rospy.wait_for_service(&quot;AddInts&quot;)    # 方式2    client.wait_for_service()        # 4.发送请求,接收并处理响应    # 方式1    resp = client(3,4)    # 方式2     resp = client(AddIntsRequest(1,5))    # 方式3    req = AddIntsRequest()     req.num1 = 100     req.num2 = 200     #优化：可以在执行节点时，动态传入参数    req.num1 = int(sys.argv[1])    # sys.argv表示：命令行参数列表    req.num2 = int(sys.argv[2])     resp = client.call(req)    rospy.loginfo(&quot;响应结果:%d&quot;,resp.sum)\n\n\n\n四、参数服务器实现不同节点之间的数据共享，参数服务器相当于是独立于所有节点的一个公共容器，可以将数据存储在该容器中，被不同的节点调用，当然不同的节点也可以往其中存储数据。类似于全局变量。\n举例：导航实现时，全局、本地路径规划都要考虑小车自身的尺寸，而小车尺寸就存储在参数服务器中。\n注意:参数服务器使用RPC协议，不是为高性能而设计的，因此最好用于存储静态的非二进制的简单数据\n参数以键值对的形式存储在参数服务器中。\n\n参数服务器操作的python实现：\n（1）增、改\n12345678910111213141516import rospyif __name__ == &quot;__main__&quot;:    #初始化节点    rospy.init_node(&quot;set_update_paramter_p&quot;)    # 设置各种类型参数    rospy.set_param(&quot;p_int&quot;,10)   #键、值    rospy.set_param(&quot;p_double&quot;,3.14)    rospy.set_param(&quot;p_bool&quot;,True)    rospy.set_param(&quot;p_string&quot;,&quot;hello python&quot;)    rospy.set_param(&quot;p_list&quot;,[&quot;hello&quot;,&quot;haha&quot;,&quot;xixi&quot;])    rospy.set_param(&quot;p_dict&quot;,&#123;&quot;name&quot;:&quot;hulu&quot;,&quot;age&quot;:8&#125;)    # 修改    rospy.set_param(&quot;p_int&quot;,100)\n\n（2）查询参数\n1234567891011121314151617181920212223242526272829303132333435363738394041import rospyif __name__ == &quot;__main__&quot;:    rospy.init_node(&quot;get_param_p&quot;)    #获取参数: get_param    int_value = rospy.get_param(&quot;p_int&quot;,10000)    double_value = rospy.get_param(&quot;p_double&quot;)    bool_value = rospy.get_param(&quot;p_bool&quot;)    string_value = rospy.get_param(&quot;p_string&quot;)    p_list = rospy.get_param(&quot;p_list&quot;)    p_dict = rospy.get_param(&quot;p_dict&quot;)    rospy.loginfo(&quot;获取的数据:%d,%.2f,%d,%s&quot;,                int_value,                double_value,                bool_value,                string_value)    for ele in p_list:        rospy.loginfo(&quot;ele = %s&quot;, ele)    rospy.loginfo(&quot;name = %s, age = %d&quot;,p_dict[&quot;name&quot;],p_dict[&quot;age&quot;])    # get_param_cached（效率比get_param高）    int_cached = rospy.get_param_cached(&quot;p_int&quot;)    rospy.loginfo(&quot;缓存数据:%d&quot;,int_cached)    # get_param_names    names = rospy.get_param_names()    for name in names:        rospy.loginfo(&quot;name = %s&quot;,name)    rospy.loginfo(&quot;-&quot;*80)    # 判断某个键是否存在：has_param    flag = rospy.has_param(&quot;p_int&quot;)    rospy.loginfo(&quot;包含p_int吗？%d&quot;,flag)    # 判断键是否存在，存在则返回键名：search_param    key = rospy.search_param(&quot;p_int&quot;)    rospy.loginfo(&quot;搜索的键 = %s&quot;,key)\n\n（3）删除参数：\n12345678910# delete_paramimport rospyif __name__ == &quot;__main__&quot;:    rospy.init_node(&quot;delete_param_p&quot;)    try:        rospy.delete_param(&quot;p_int&quot;)    except Exception as e:        rospy.loginfo(&quot;删除失败&quot;)\n\n五、常用命令以下介绍的命令都可以直接在命令行中实现，不需要创建节点；但缺点是不能包含太复杂的逻辑，只能做一些简单的实现（比如往参数服务器里添加参数、rostopic pub发布简单的话题）\n1.rosnode\n123456rosnode ping  xxx   #测试到节点的连接状态rosnode list    #列出活动节点rosnode info  xxx    #打印节点信息rosnode machine    #列出指定设备上节点rosnode kill  xxx    #杀死某个节点rosnode cleanup     #清除不可连接的节点\n\n2.rostopic\n123456789rostopic list   #显示所有活动状态下的主题rostopic echo   #打印话题消息到屏幕  rostopic  echo  /turtle1/cmd_velrostopic pub    #将数据发布到主题rostopic bw     #显示主题使用的带宽rostopic delay  #显示带有 header 的主题延迟rostopic find   #根据类型查找主题rostopic hz     #显示主题的发布频率rostopic info   #显示主题相关信息rostopic type   #打印主题类型\n\n3.rosmsg\n123456rosmsg show   # 显示消息描述rosmsg info    #显示消息信息rosmsg list    #列出所有消息rosmsg md5    #显示 md5 加密后的消息rosmsg package    #显示某个功能包下的所有消息rosmsg packages    #列出包含消息的功能包\n\n4.rosservice\n1234567rosservice args  #打印服务参数rosservice call    #使用提供的参数调用服务rosservice find    #按照服务类型查找服务rosservice info    #打印有关服务的信息rosservice list     #列出所有活动的服务rosservice type    #打印服务类型rosservice uri     #打印服务的 ROSRPC uri\n\n5.rossrv\n123456rossrv show    #显示服务消息详情rossrv info    #显示服务消息相关信息rossrv list    #列出所有服务信息rossrv md5    #显示 md5 加密后的服务消息rossrv package    #显示某个包下所有服务消息rossrv packages    #显示包含服务消息的所有包\n\n6.rosparam\n123456rosparam set    #设置参数  rosparam set name xiaohuangrosparam get    #获取参数rosparam load    #从外部文件加载参数  ---&gt;反序列化rosparam dump    #将参数写出到外部文件(yaml文件) ---&gt;序列化rosparam delete    #删除参数rosparam list    #列出所有参数\n\n\n\n六、实操1.乌龟控制节点实操举例：\n\n自己编写乌龟控制节点，实现乌龟的圆周运动。\n\n123rqt_graph   #通过计算图查看话题名称rostopic type /turtle1/cmd_vel  #查看话题信息，获知消息类型为geometry_msgs/Twistrosmsg info geometry_msgs/Twist  #查看消息格式\n\n消息格式：\ngeometry_msgs/Vector3 linear  float64 x  float64 y  float64 zgeometry_msgs/Vector3 angular  float64 x  float64 y  float64 z\nlinear线速度，xyz分别对应在x、y和z方向上的速度(单位是 m/s)；\nangular角速度，xyz分别对应x轴上的翻滚、y轴上俯仰和z轴上偏航的速度(单位是rad/s)\n偏航、翻滚与俯仰（RPY）：\n\n\n\n\n\n实现控制节点（话题发布节点）\n\n123456789101112131415161718192021222324252627  ##将控制乌龟做圆周运动      #1.获取topic(已知: /turtle1/cmd_vel)  #2.获取消息类型(已知: geometry_msgs/Twist)  #3.运行前，注意先启动 turtlesim_node 节点import rospyfrom geometry_msgs.msg import Twistif __name__ == &quot;__main__&quot;:    # 2.初始化 ROS 节点    rospy.init_node(&quot;control_circle_p&quot;)    # 3.创建发布者对象    pub = rospy.Publisher(&quot;/turtle1/cmd_vel&quot;,Twist,queue_size=1000)    # 4.循环发布运动控制消息    rate = rospy.Rate(10)    msg = Twist()    msg.linear.x = 1.0    #不能横着走    msg.linear.y = 0.0    msg.linear.z = 0.0    msg.angular.x = 0.0    msg.angular.y = 0.0    msg.angular.z = 0.5   #只能偏航            while not rospy.is_shutdown():        pub.publish(msg)        rate.sleep()\n\n12345#自定义的节点编写好之后：#三个终端中：roscorerosrun  turtlesim  turtlesim_node  rosrun  &lt;自定义的功能包&gt;  &lt;编写的节点文件名&gt;\n\n\n\n2.乌龟位姿信息订阅节点实操\n已知turtlesim_node的位姿消息类型为：turtlesim/Pose\nfloat32 xfloat32 yfloat32 thetafloat32 linear_velocityfloat32 angular_velocity\n位姿信息订阅节点的实现：\n1234567891011121314151617181920 #1.获取话题名称 /turtle1/pose #2.获取消息类型 turtlesim/Pose #3.运行前启动 turtlesim_node 与 turtle_teleop_key 节点    import rospyfrom turtlesim.msg import Posedef doPose(data):    rospy.loginfo(&quot;乌龟坐标:x=%.2f, y=%.2f,theta=%.2f&quot;,data.x,data.y,data.theta)if __name__ == &quot;__main__&quot;:    # 2.初始化 ROS 节点    rospy.init_node(&quot;sub_pose_p&quot;)    # 3.创建订阅者对象    sub = rospy.Subscriber(&quot;/turtle1/pose&quot;,Pose,doPose,queue_size=1000)    #     4.回调函数处理订阅的数据    #     5.spin    rospy.spin()\n\n\n\n3.（服务通信）指定位置添加turtle的服务端请求实现：\n服务也是基于话题的，所以首先是查看话题的消息类型：\n123# 新增乌龟的话题是/spawnrosservice type /spawn  #获取消息类型为turtlesim/Spawnrossrv info turtlesim/Spawn  #获取消息格式\n\n节点的实现大同小异，略\n4.（参数服务器）参数设置\n可通过launch文件传参，后面再介绍。\n七、常用API（python实现）1.节点初始化\n重点在于anonymous参数的使用：\n12rospy.init_node(&quot;happy_node&quot;, anonymous=True)    #anonymous = true 时，为节点名称后缀随机编号                                                                                                             #这样就可重复启动节点了！\n\n2.话题与服务相关对象\nPublisher、Subscriber、Server、Client的创建，publish操作等\n1#需要就查\n\n3.回调函数\n相比C++，没有spinOnce( )函数，只有spin( )函数\n1rospy.spin( )\n\n\n\n4.时间\n（1）获取、设置时刻\n12345678910# 获取当前时刻right_now = rospy.Time.now()  #rospy中有Time库，获取的是相对于1970年1月1日的时间rospy.loginfo(&quot;当前时刻:%.2f&quot;,right_now.to_sec())  #设置输出日志logrospy.loginfo(&quot;当前时刻:%.2f&quot;,right_now.to_nsec())# 自定义时刻some_time1 = rospy.Time(1234.567891011)  #some_time1是从1970.1.1的0时0分0秒开始往后1234.567891011秒some_time2 = rospy.Time(1234,567891011)rospy.loginfo(&quot;设置时刻1:%.2f&quot;,some_time1.to_sec())rospy.loginfo(&quot;设置时刻2:%.2f&quot;,some_time2.to_sec())\n\n（2）持续时间\n12345du = rospy.Duration(3.3)rospy.loginfo(&quot;du1 持续时间:%.2f&quot;,du.to_sec())rospy.sleep(du) #休眠函数rospy.loginfo(&quot;持续时间测试结束.....&quot;)\n\n（3）持续时间与时刻的运算\n123456789101112now = rospy.Time.now()du1 = rospy.Duration(10)du2 = rospy.Duration(20)#运算before_now = now - du1after_now = now + du1dd = du1 + du2# now = now + now  #非法rospy.loginfo(&quot;之前时刻:%.2f&quot;,before_now.to_sec())rospy.loginfo(&quot;之后时刻:%.2f&quot;,after_now.to_sec())rospy.loginfo(&quot;持续时间相加:%.2f&quot;,dd.to_sec())\n\n（4）设置运行频率\n123456#通过rate.sleep( )实现，隔某段时间执行某种操作rate = rospy.Rate(0.5)while not rospy.is_shutdown():    rate.sleep() #休眠    rospy.loginfo(&quot;+++++++++++++++&quot;)\n\n（5）定时器，类似于rospy.Rate的功能：隔某段时间执行某种操作\n12345rospy.Timer(rospy.Duration(1),doMsg)   #每隔1s，执行回调函数doMsgrospy.spin()rospy.Timer(rospy.Duration(1),doMsg,True)  # 只执行一次rospy.spin()\n\n（6）节点判断与关闭\n12345678#节点状态判断rospy.is_shutdown()#节点关闭函数rospy.signal_shutdown(&quot;不想用了&quot;)  #传参是字符串，说明关闭原因#关闭节点，同时执行回调函数rospy.on_shutdown(doMsg)\n\n（7）日志函数：相当于实时打印一些提示信息\n日志相关的函数也是极其常用的，在ROS中日志被划分成如下级别：\n12345rospy.logdebug(&quot;hello,debug&quot;)  #不会输出到控制台，调试时常用rospy.loginfo(&quot;hello,info&quot;)  #标准消息，默认白色字体rospy.logwarn(&quot;hello,warn&quot;)  #提醒一些异常情况，默认黄色字体rospy.logerr(&quot;hello,error&quot;)  #提示错误信息，默认红色字体rospy.logfatal(&quot;hello,fatal&quot;) #此类错误将阻止节点继续运行，默认红色字体\n\n\n\n5.python模块导入\n先编写自定义模块文件（相当于C++头文件）：\n123# tools.py文件num=1000\n\n另一个python文件中调用模块A：\n12import toolsrospy.loginfo(&quot;num = %d&quot;,tools.num)\n\n如果直接import新写的模块，会报错\n原因：rosrun执行时，参考路径是workspace的路径，在workspace下无法查找到依赖的模块\n解决：先声明环境变量\n123456789import osimport sys#为了增加代码的可移植性，用os自动获取当前路径的前一级path = os.path.abspath(&quot;.&quot;)sys.path.insert(0, path + &quot;/src/plumbing_pub_sub/scripts&quot;)  #将模块文件所在路径添加到sys.path中import tools    rospy.loginfo(&quot;num = %d&quot;,tools.num)  \n\n","dateCreated":"2021-04-14T14:22:51+08:00","dateModified":"2021-04-14T14:30:13+08:00","datePublished":"2021-04-14T14:22:51+08:00","description":"入门的概念已经了解，本系列是我在系统学习ROS中的笔记。ROS知识点繁多，有些内容用到的时候google或者wiki查询，不做记录。","headline":"系统学习ROS（一）","image":[],"mainEntityOfPage":{"@type":"WebPage","@id":"http://example.com/2021/04/14/%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0ROS%EF%BC%88%E4%B8%80%EF%BC%89/"},"publisher":{"@type":"Organization","name":"Eric Tan","sameAs":["https://github.com/","http://stackoverflow.com/users","https://twitter.com/","https://facebook.com/","https://plus.google.com/","https://www.linkedin.com/profile/","mailto"]},"url":"http://example.com/2021/04/14/%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0ROS%EF%BC%88%E4%B8%80%EF%BC%89/"}</script>
    <meta name="description" content="入门的概念已经了解，本系列是我在系统学习ROS中的笔记。ROS知识点繁多，有些内容用到的时候google或者wiki查询，不做记录。">
<meta property="og:type" content="blog">
<meta property="og:title" content="系统学习ROS（一）">
<meta property="og:url" content="http://example.com/2021/04/14/%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0ROS%EF%BC%88%E4%B8%80%EF%BC%89/index.html">
<meta property="og:site_name" content="Eric Tan">
<meta property="og:description" content="入门的概念已经了解，本系列是我在系统学习ROS中的笔记。ROS知识点繁多，有些内容用到的时候google或者wiki查询，不做记录。">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/images/image-20210414142652602.png">
<meta property="og:image" content="http://example.com/images/image-20210414142557153.png">
<meta property="article:published_time" content="2021-04-14T06:22:51.000Z">
<meta property="article:modified_time" content="2021-04-14T06:30:13.623Z">
<meta property="article:author" content="Eric Tan">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/images/image-20210414142652602.png">
    
    
        
    
    
    
    
    
    <!--STYLES-->
    
<link rel="stylesheet" href="/assets/css/style-avgrqz8jhyoidabpqs5wzkidsky3osgmw4xscwbmmpkuhuen3z0qho9qrrme.min.css">

    <!--STYLES END-->
    

    

    
        
    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    

<header id="header" data-behavior="4">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a
            class="header-title-link"
            href="/"
            aria-label=""
        >
            Eric Tan
        </a>
    </div>
    
        
            <a
                class="header-right-picture "
                href="#about"
                aria-label="Open the link: /#about"
            >
        
        
        </a>
    
</header>

            <!-- Define author's picture -->


<nav id="sidebar" data-behavior="4">
    <div class="sidebar-container">
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/"
                            
                            rel="noopener"
                            title="Home"
                        >
                        <i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Home</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-categories"
                            
                            rel="noopener"
                            title="Categories"
                        >
                        <i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Categories</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-tags"
                            
                            rel="noopener"
                            title="Tags"
                        >
                        <i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Tags</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-archives"
                            
                            rel="noopener"
                            title="Archives"
                        >
                        <i class="sidebar-button-icon fa fa-archive" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Archives</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link open-algolia-search"
                            href="#search"
                            
                            rel="noopener"
                            title="Search"
                        >
                        <i class="sidebar-button-icon fa fa-search" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Search</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="#about"
                            
                            rel="noopener"
                            title="About"
                        >
                        <i class="sidebar-button-icon fa fa-question" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">About</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://github.com/"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="GitHub"
                        >
                        <i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="http://stackoverflow.com/users"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="Stack Overflow"
                        >
                        <i class="sidebar-button-icon fab fa-stack-overflow" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Stack Overflow</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://twitter.com/"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="Twitter"
                        >
                        <i class="sidebar-button-icon fab fa-twitter" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Twitter</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://facebook.com/"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="Facebook"
                        >
                        <i class="sidebar-button-icon fab fa-facebook" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Facebook</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://plus.google.com/"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="Google +"
                        >
                        <i class="sidebar-button-icon fab fa-google-plus" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Google +</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://www.linkedin.com/profile/"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="LinkedIn"
                        >
                        <i class="sidebar-button-icon fab fa-linkedin" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">LinkedIn</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/mailto"
                            
                            rel="noopener"
                            title="Mail"
                        >
                        <i class="sidebar-button-icon fa fa-envelope" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Mail</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/atom.xml"
                            
                            rel="noopener"
                            title="RSS"
                        >
                        <i class="sidebar-button-icon fa fa-rss" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">RSS</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
            <div id="main" data-behavior="4"
                 class="
                        hasCoverMetaIn
                        ">
                
<article class="post">
    
    
        <div class="post-header main-content-wrap text-left">
    
        <h1 class="post-title">
            系统学习ROS（一）
        </h1>
    
    
        <div class="post-meta">
    <time datetime="2021-04-14T14:22:51+08:00">
	
		    Apr 14, 2021
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/ROS/">ROS</a>


    
</div>

    
</div>

    
    <div class="post-content markdown">
        <div class="main-content-wrap">
            <p>入门的概念已经了解，本系列是我在系统学习ROS中的笔记。ROS知识点繁多，有些内容用到的时候google或者wiki查询，不做记录。</p>
<span id="more"></span>

<p>同时，只记录python实现版本。</p>
<p><strong>学习地址（全文参考）</strong>：<a target="_blank" rel="noopener" href="http://www.autolabor.com.cn/book/ROSTutorials/">http://www.autolabor.com.cn/book/ROSTutorials/</a></p>
<h3 id="一、基础知识"><a href="#一、基础知识" class="headerlink" title="一、基础知识"></a>一、基础知识</h3><h4 id="1-基本开发流程"><a href="#1-基本开发流程" class="headerlink" title="1.基本开发流程"></a>1.基本开发流程</h4><ol>
<li>创建工作空间；</li>
<li>创建功能包；</li>
<li>编辑源文件；（.cpp、.py）</li>
<li>编辑配置文件；</li>
<li>编译并执行。</li>
</ol>
<h4 id="2-workspace以及功能包的编译与使用"><a href="#2-workspace以及功能包的编译与使用" class="headerlink" title="2.workspace以及功能包的编译与使用"></a>2.workspace以及功能包的编译与使用</h4><p>（1）创建workspace：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p test_ws&#x2F;src</span><br><span class="line">cd test_ws</span><br><span class="line">catkin_make  #编译工作空间</span><br></pre></td></tr></table></figure>

<p>（2）创建功能包：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd src</span><br><span class="line">catkin_create_pkg &lt;depend&gt; roscpp rospy std_msgs  # 通常都需要roscpp、rospy</span><br></pre></td></tr></table></figure>



<p><strong>学习过程中：</strong></p>
<p>ubuntu工作空间创建好后，可以一直用；例如创建了test_ws工作空间，该空间已经编译完成，有自动生成的devel、build文件夹，则后续可以在该workspace下添加功能包。</p>
<p>在src文件夹下：有多个功能包，在学习过程中直接将源码功能包放进来;</p>
<p>编译功能包：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#在根目录下</span><br><span class="line">catkin_make</span><br><span class="line">source devel&#x2F;setup.bash   #此命令只对当前终端有效，要想一劳永逸，见下面方法</span><br></pre></td></tr></table></figure>

<p>然后就可以roslaunch执行launch文件啦！</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#方法一</span><br><span class="line">直接使用 gedit 或 vi 编辑 .bashrc 文件，最后添加该内容</span><br><span class="line"></span><br><span class="line">#方法二</span><br><span class="line">echo &quot;source ~&#x2F;工作空间&#x2F;devel&#x2F;setup.bash&quot; &gt;&gt; ~&#x2F;.bashrc</span><br><span class="line"></span><br><span class="line">最后在终端中执行：</span><br><span class="line">source .bashrc  #之后在所有终端中都可以一劳永逸了！</span><br></pre></td></tr></table></figure>



<h4 id="3-集成开发环境："><a href="#3-集成开发环境：" class="headerlink" title="3.集成开发环境："></a>3.集成开发环境：</h4><p>选择VS Code，有了集成开发环境，可以不用再在记事本当中写代码了！</p>
<p>（1）集成开发环境提供了图形化界面，可以可视化地创建功能包、程序文件等；</p>
<p>（2）为VScode安装如下插件：C++、Python、Cmake、ROS</p>
<p>（3）进行一些配置，将作者的配置文件直接复制，此后可以通过<code>Ctrl+Shift+B</code>直接完成编译（相当与<code>catkin_make</code>）</p>
<p>（4）无论是C++还是python程序，都需要在CMakeList文件中做配置，再编译；</p>
<h4 id="4-launch文件"><a href="#4-launch文件" class="headerlink" title="4.launch文件"></a>4.launch文件</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;launch&gt;</span><br><span class="line">    &lt;node pkg&#x3D;&quot;helloworld&quot; type&#x3D;&quot;demo_hello&quot; name&#x3D;&quot;hello&quot; output&#x3D;&quot;screen&quot; &#x2F;&gt;</span><br><span class="line">    &lt;node pkg&#x3D;&quot;turtlesim&quot; type&#x3D;&quot;turtlesim_node&quot; name&#x3D;&quot;t1&quot;&#x2F;&gt;</span><br><span class="line">    &lt;node pkg&#x3D;&quot;turtlesim&quot; type&#x3D;&quot;turtle_teleop_key&quot; name&#x3D;&quot;key1&quot; &#x2F;&gt;</span><br><span class="line">&lt;&#x2F;launch&gt;</span><br><span class="line"></span><br><span class="line">roslaunch 包名 launch文件名</span><br><span class="line"></span><br><span class="line"># node ---&gt; 包含的某个节点</span><br><span class="line"># pkg -----&gt; 功能包</span><br><span class="line"># type ----&gt; 被运行的节点文件</span><br><span class="line"># name --&gt; 为节点命名</span><br><span class="line"># output-&gt; 设置日志的输出目标</span><br></pre></td></tr></table></figure>



<h4 id="5-文件系统架构："><a href="#5-文件系统架构：" class="headerlink" title="5.文件系统架构："></a>5.文件系统架构：</h4><img src="/images/image-20210414142652602.png" alt="image-20210414142652602" style="zoom:67%;">

<p>经常编辑这些功能包就会熟悉起来</p>
<h4 id="6-ROS文件系统常用命令"><a href="#6-ROS文件系统常用命令" class="headerlink" title="6.ROS文件系统常用命令"></a>6.ROS文件系统常用命令</h4><p>ROS专门提供了一些类似于Linux的命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install xxx   #安装 ROS功能包</span><br><span class="line">sudo apt purge xxx    #删除某个功能包</span><br><span class="line"></span><br><span class="line">rospack list   #列出所有功能包</span><br><span class="line">rospack find 包名   #查找某个功能包是否存在，如果存在返回安装路径</span><br><span class="line">apt search xxx    # 在网上搜索某个功能包</span><br></pre></td></tr></table></figure>



<h4 id="7-ROS计算图"><a href="#7-ROS计算图" class="headerlink" title="7.ROS计算图"></a>7.ROS计算图</h4><p>rqt_graph能够创建一个显示当前系统运行情况的动态图形</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rqt_graph</span><br></pre></td></tr></table></figure>





<h4 id="二、话题通信"><a href="#二、话题通信" class="headerlink" title="二、话题通信"></a>二、话题通信</h4><p>话题通信是基于<strong>发布订阅</strong>模式的，也即:一个节点发布消息，另一个节点订阅该消息。</p>
<p>例如：机器人在执行导航功能，使用的传感器是激光雷达，机器人会采集激光雷达感知到的信息并计算，然后生成运动控制信息驱动机器人底盘运动。</p>
<p>上述过程涉及多次话题通信：</p>
<p>（1）以激光雷达信息的采集处理为例，在 ROS 中有一个节点需要时时的<strong>发布</strong>当前雷达采集到的数据，导航模块中也有节点会<strong>订阅</strong>并解析雷达数据；</p>
<p>（2）再以运动消息的发布为例，导航模块会根据传感器采集的数据时时的计算出运动控制信息并<strong>发布</strong>给底盘，底盘也可以有一个节点<strong>订阅</strong>运动信息并最终转换成控制电机的脉冲信号；</p>
<p>以此类推，像雷达、摄像头、GPS…. 等等一些传感器数据的采集，也都是使用了话题通信，换言之，话题通信适用于<strong>不断更新的、少逻辑处理的数据传输相</strong>关的应用场景。</p>
<p>1.C++</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#在订阅者实现中：</span><br><span class="line">ros : : spin( )     # 回调函数：处理订阅的数据</span><br><span class="line"></span><br><span class="line">#发布者需要等待回调函数：</span><br><span class="line">ros : : spinOnce( ) </span><br></pre></td></tr></table></figure>

<p>2.python实现：（发布最简单的<code>hello</code>信息）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Publisher</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#1.导包 </span></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">from</span> std_msgs.msg <span class="keyword">import</span> String    <span class="comment">#发布消息的类型</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment">#2.初始化 ROS 节点:命名(唯一)</span></span><br><span class="line">    rospy.init_node(<span class="string">&quot;talker_p&quot;</span>)      <span class="comment">#直接传入节点名称</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">#3.实例化 发布者 对象</span></span><br><span class="line">    pub = rospy.Publisher(<span class="string">&quot;chatter&quot;</span>,String,queue_size=<span class="number">10</span>)  <span class="comment">#话题名称、消息类型、缓存队列长度</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">#4.组织被发布的数据，并编写逻辑发布数据</span></span><br><span class="line">    msg = String()  <span class="comment">#创建 msg 对象</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 设置循环频率</span></span><br><span class="line">    rate = rospy.Rate(<span class="number">1</span>)   <span class="comment"># 1Hz</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> rospy.is_shutdown():   <span class="comment">#使用rospy中的函数，判断节点没有关闭</span></span><br><span class="line">        msg.data = <span class="string">&quot;hello&quot;</span>   <span class="comment">#定义发布的消息</span></span><br><span class="line">        pub.publish(msg)</span><br><span class="line">        rate.sleep()  <span class="comment">#每隔rate秒醒过来</span></span><br><span class="line">        rospy.loginfo(<span class="string">&quot;发布的数据是:%s&quot;</span>,msg.data）</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#编译python文件流程：(以配置好的VS Code为例)          以后所有运行的python程序都要经过这一步</span></span><br><span class="line"><span class="number">1.</span>终端添加可执行权限：chmod  +x  *.py</span><br><span class="line"><span class="number">2.</span>修改CmakeList文件：</span><br><span class="line">    catkin_install_python(PROGRAMS</span><br><span class="line">        scripts/demo_pubpy.py</span><br><span class="line">        DESTINATION $&#123;CATKIN_PACKAGE_BIN_DESTINATION&#125;</span><br><span class="line">         )</span><br><span class="line"><span class="number">3.</span> Ctrl+Shift+B编译</span><br><span class="line"><span class="number">4.</span> roscore+rosrun运行即可</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Subscriber</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#1.导包 </span></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">from</span> std_msgs.msg <span class="keyword">import</span> String</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">doMsg</span>(<span class="params">msg</span>):</span>  <span class="comment">#定义回调函数</span></span><br><span class="line">    rospy.loginfo(<span class="string">&quot;我订阅的数据：%s&quot;</span>,msg.data)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment">#2.初始化 ROS 节点:命名(唯一)</span></span><br><span class="line">    rospy.init_node(<span class="string">&quot;listener_p&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">#3.实例化 订阅者 对象</span></span><br><span class="line">    sub = rospy.Subscriber(<span class="string">&quot;chatter&quot;</span>,String, doMsg, queue_size=<span class="number">10</span>)  <span class="comment">#话题名称、消息类型、回调函数、队列长度</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">#4.处理订阅的消息(回调函数)</span></span><br><span class="line">    <span class="comment">#5.设置循环调用回调函数</span></span><br><span class="line">    rospy.spin()</span><br></pre></td></tr></table></figure>



<p>3.自定义消息</p>
<p>ROS 中通过 std_msgs 封装了一些原生的数据类型,比如:String、Int32、Int64、Char、Bool、Empty…. 但是，这些数据一般只包含一个 data 字段—&gt;用于接受消息</p>
<p>应用场景：传递一些复杂数据时</p>
<ul>
<li><strong>流程：</strong></li>
</ul>
<p>（1）定义msg文件：功能包下新建 msg 目录，添加文件 Person.msg</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">string name</span><br><span class="line">uint16 age</span><br><span class="line">float64 height</span><br></pre></td></tr></table></figure>

<p>（2）编辑配置文件package.xml</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;build_depend&gt;message_generation&lt;/build_depend&gt;   #message_generation</span><br><span class="line">&lt;exec_depend&gt;message_runtime&lt;/exec_depend&gt;   #message_runtime</span><br></pre></td></tr></table></figure>

<p>（3）<strong>CMakeLists.txt</strong>编辑 msg 相关配置</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">find_package(catkin REQUIRED COMPONENTS</span><br><span class="line">  roscpp</span><br><span class="line">  rospy</span><br><span class="line">  std_msgs</span><br><span class="line">  message_generation</span><br><span class="line">)</span><br><span class="line"><span class="comment"># 需要加入 message_generation,必须有 std_msgs</span></span><br><span class="line"></span><br><span class="line">add_message_files(</span><br><span class="line">  FILES</span><br><span class="line">  Person.msg</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">generate_messages(</span><br><span class="line">  DEPENDENCIES</span><br><span class="line">  std_msgs</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">#执行时依赖</span></span><br><span class="line">catkin_package(</span><br><span class="line"><span class="comment">#  INCLUDE_DIRS include</span></span><br><span class="line"><span class="comment">#  LIBRARIES demo02_talker_listener</span></span><br><span class="line">  CATKIN_DEPENDS roscpp rospy std_msgs message_runtime</span><br><span class="line"><span class="comment">#  DEPENDS system_lib</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>python实现发布、订阅自定义消息</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Publisher发布自定义的Person类型消息</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">from</span> demo02_talker_listener.msg <span class="keyword">import</span> Person  <span class="comment">#自定义的消息类型文件</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment">#1.初始化 ROS 节点</span></span><br><span class="line">    rospy.init_node(<span class="string">&quot;talker_person_p&quot;</span>)</span><br><span class="line">    <span class="comment">#2.创建发布者对象</span></span><br><span class="line">    pub = rospy.Publisher(<span class="string">&quot;chatter_person&quot;</span>,Person,queue_size=<span class="number">10</span>)</span><br><span class="line">    <span class="comment">#3.组织消息  （自定义的Person类型）</span></span><br><span class="line">    p = Person()</span><br><span class="line">    p.name = <span class="string">&quot;葫芦瓦&quot;</span></span><br><span class="line">    p.age = <span class="number">18</span></span><br><span class="line">    p.height = <span class="number">0.75</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#4.编写消息发布逻辑</span></span><br><span class="line">    rate = rospy.Rate(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> rospy.is_shutdown():</span><br><span class="line">        pub.publish(p)  <span class="comment">#发布消息</span></span><br><span class="line">        rate.sleep()  <span class="comment">#休眠</span></span><br><span class="line">        rospy.loginfo(<span class="string">&quot;姓名:%s, 年龄:%d, 身高:%.2f&quot;</span>,p.name, p.age, p.height)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Subscriber订阅自定义的Person类型消息</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">from</span> demo02_talker_listener.msg <span class="keyword">import</span> Person</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">doPerson</span>(<span class="params">p</span>):</span>  <span class="comment">#定义回调函数</span></span><br><span class="line">    rospy.loginfo(<span class="string">&quot;接收到的人的信息:%s, %d, %.2f&quot;</span>,p.name, p.age, p.height)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment">#1.初始化节点</span></span><br><span class="line">    rospy.init_node(<span class="string">&quot;listener_person_p&quot;</span>)</span><br><span class="line">    <span class="comment">#2.创建订阅者对象</span></span><br><span class="line">    sub = rospy.Subscriber(<span class="string">&quot;chatter_person&quot;</span>,Person, doPerson, queue_size=<span class="number">10</span>)</span><br><span class="line">    rospy.spin() <span class="comment">#4.循环</span></span><br></pre></td></tr></table></figure>



<h4 id="三、服务通信"><a href="#三、服务通信" class="headerlink" title="三、服务通信"></a>三、服务通信</h4><p>无论是话题还是服务通信，都是以来于<strong>话题</strong>的！</p>
<p>基于<strong>请求响应</strong>模式，适用于<strong>对时时性有要求、具有一定逻辑处理</strong>的应用场景。</p>
<p>ROS Master 负责保管 Server 和 Client 注册的信息，并匹配<strong>话题相同</strong>的 Server 与 Client ，帮助 Server 与 Client 建立连接，连接建立后，Client 发送请求信息，Server 返回响应信息。</p>
<p>对<strong>时序</strong>有严格要求：客户端发起请求时，必须保证服务端已经启动。</p>
<p>1.自定义服务消息类型srv文件：</p>
<p>功能包下新建 srv 目录，添加 xxx.srv 文件，内容:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 客户端请求时发送的两个数字</span></span><br><span class="line">int32 num1</span><br><span class="line">int32 num2</span><br><span class="line">---                                                       <span class="comment">#在 srv 文件中请求和响应使用---分割</span></span><br><span class="line"><span class="comment"># 服务器响应发送的数据</span></span><br><span class="line">int32 <span class="built_in">sum</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>编辑配置文件</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#package.xml</span></span><br><span class="line"></span><br><span class="line">  &lt;build_depend&gt;message_generation&lt;/build_depend&gt;</span><br><span class="line">  &lt;exec_depend&gt;message_runtime&lt;/exec_depend&gt;</span><br><span class="line">  &lt;!-- </span><br><span class="line">  exce_depend 以前对应的是 run_depend 现在非法</span><br><span class="line">  --&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#CMakeList</span></span><br><span class="line"></span><br><span class="line">find_package(catkin REQUIRED COMPONENTS</span><br><span class="line">  roscpp</span><br><span class="line">  rospy</span><br><span class="line">  std_msgs</span><br><span class="line">  message_generation</span><br><span class="line">)</span><br><span class="line"><span class="comment"># 需要加入 message_generation,必须有 std_msgs</span></span><br><span class="line"></span><br><span class="line">add_service_files(</span><br><span class="line">  FILES</span><br><span class="line">  AddInts.srv</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">generate_messages(</span><br><span class="line">  DEPENDENCIES</span><br><span class="line">  std_msgs</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>2.Server、Client的python实现</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Server ： 解析客户端请求，产生响应</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1.导包</span></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">from</span> demo03_server_client.srv <span class="keyword">import</span> AddInts,AddIntsRequest,AddIntsResponse</span><br><span class="line"></span><br><span class="line"><span class="comment"># 回调函数的参数是请求对象，返回值是响应对象</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">doReq</span>(<span class="params">req</span>):</span></span><br><span class="line">    <span class="comment"># 解析提交的数据</span></span><br><span class="line">    <span class="built_in">sum</span> = req.num1 + req.num2</span><br><span class="line">    rospy.loginfo(<span class="string">&quot;提交的数据:num1 = %d, num2 = %d, sum = %d&quot;</span>,req.num1, req.num2, <span class="built_in">sum</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#将结果封装进响应</span></span><br><span class="line">    <span class="comment"># 创建响应对象，赋值并返回</span></span><br><span class="line">    <span class="comment"># resp = AddIntsResponse()</span></span><br><span class="line">    <span class="comment"># resp.sum = sum</span></span><br><span class="line">    resp = AddIntsResponse(<span class="built_in">sum</span>)</span><br><span class="line">    <span class="keyword">return</span> resp </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment"># 2.初始化 ROS 节点</span></span><br><span class="line">    rospy.init_node(<span class="string">&quot;addints_server_p&quot;</span>)</span><br><span class="line">    <span class="comment"># 3.创建服务对象</span></span><br><span class="line">    server = rospy.Service(<span class="string">&quot;AddInts&quot;</span>,AddInts,doReq)    <span class="comment">#话题名称，消息类型，回调函数</span></span><br><span class="line">    <span class="comment"># 4.回调函数处理请求并产生响应</span></span><br><span class="line">    <span class="comment"># 5.spin 函数</span></span><br><span class="line">    rospy.spin()</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Client：</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#1.导包</span></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">from</span> demo03_server_client.srv <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line"></span><br><span class="line">    <span class="comment">#优化实现</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(sys.argv) != <span class="number">3</span>:    <span class="comment">#判断动态传入的参数是否为3个</span></span><br><span class="line">        rospy.logerr(<span class="string">&quot;请正确提交参数&quot;</span>)</span><br><span class="line">        sys.exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2.初始化 ROS 节点</span></span><br><span class="line">    rospy.init_node(<span class="string">&quot;AddInts_Client_p&quot;</span>)</span><br><span class="line">    <span class="comment"># 3.创建Client对象</span></span><br><span class="line">    client = rospy.ServiceProxy(<span class="string">&quot;AddInts&quot;</span>,AddInts)   <span class="comment">#话题名称、消息类型</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 请求前，等待服务已经就绪：防止启动顺序出错（鲁棒性设置）</span></span><br><span class="line">    <span class="comment"># 方式1:</span></span><br><span class="line">     rospy.wait_for_service(<span class="string">&quot;AddInts&quot;</span>)</span><br><span class="line">    <span class="comment"># 方式2</span></span><br><span class="line">    client.wait_for_service()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 4.发送请求,接收并处理响应</span></span><br><span class="line">    <span class="comment"># 方式1</span></span><br><span class="line">    resp = client(<span class="number">3</span>,<span class="number">4</span>)</span><br><span class="line">    <span class="comment"># 方式2</span></span><br><span class="line">     resp = client(AddIntsRequest(<span class="number">1</span>,<span class="number">5</span>))</span><br><span class="line">    <span class="comment"># 方式3</span></span><br><span class="line">    req = AddIntsRequest()</span><br><span class="line">     req.num1 = <span class="number">100</span></span><br><span class="line">     req.num2 = <span class="number">200</span> </span><br><span class="line"></span><br><span class="line">    <span class="comment">#优化：可以在执行节点时，动态传入参数</span></span><br><span class="line">    req.num1 = <span class="built_in">int</span>(sys.argv[<span class="number">1</span>])    <span class="comment"># sys.argv表示：命令行参数列表</span></span><br><span class="line">    req.num2 = <span class="built_in">int</span>(sys.argv[<span class="number">2</span>]) </span><br><span class="line"></span><br><span class="line">    resp = client.call(req)</span><br><span class="line">    rospy.loginfo(<span class="string">&quot;响应结果:%d&quot;</span>,resp.<span class="built_in">sum</span>)</span><br></pre></td></tr></table></figure>



<h4 id="四、参数服务器"><a href="#四、参数服务器" class="headerlink" title="四、参数服务器"></a>四、参数服务器</h4><p>实现不同节点之间的数据共享，参数服务器相当于是独立于所有节点的一个公共容器，可以将数据存储在该容器中，被不同的节点调用，当然不同的节点也可以往其中存储数据。类似于<strong>全局变量</strong>。</p>
<p>举例：导航实现时，全局、本地路径规划都要考虑小车自身的尺寸，而小车尺寸就存储在参数服务器中。</p>
<p>注意:参数服务器使用RPC协议，不是为高性能而设计的，因此最好用于存储静态的非二进制的简单数据</p>
<p>参数以<strong>键值对</strong>的形式存储在参数服务器中。</p>
<ul>
<li><p>参数服务器操作的python实现：</p>
<p>（1）增、改</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment">#初始化节点</span></span><br><span class="line">    rospy.init_node(<span class="string">&quot;set_update_paramter_p&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 设置各种类型参数</span></span><br><span class="line">    rospy.set_param(<span class="string">&quot;p_int&quot;</span>,<span class="number">10</span>)   <span class="comment">#键、值</span></span><br><span class="line">    rospy.set_param(<span class="string">&quot;p_double&quot;</span>,<span class="number">3.14</span>)</span><br><span class="line">    rospy.set_param(<span class="string">&quot;p_bool&quot;</span>,<span class="literal">True</span>)</span><br><span class="line">    rospy.set_param(<span class="string">&quot;p_string&quot;</span>,<span class="string">&quot;hello python&quot;</span>)</span><br><span class="line">    rospy.set_param(<span class="string">&quot;p_list&quot;</span>,[<span class="string">&quot;hello&quot;</span>,<span class="string">&quot;haha&quot;</span>,<span class="string">&quot;xixi&quot;</span>])</span><br><span class="line">    rospy.set_param(<span class="string">&quot;p_dict&quot;</span>,&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;hulu&quot;</span>,<span class="string">&quot;age&quot;</span>:<span class="number">8</span>&#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 修改</span></span><br><span class="line">    rospy.set_param(<span class="string">&quot;p_int&quot;</span>,<span class="number">100</span>)</span><br></pre></td></tr></table></figure>

<p>（2）查询参数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    rospy.init_node(<span class="string">&quot;get_param_p&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#获取参数: get_param</span></span><br><span class="line">    int_value = rospy.get_param(<span class="string">&quot;p_int&quot;</span>,<span class="number">10000</span>)</span><br><span class="line">    double_value = rospy.get_param(<span class="string">&quot;p_double&quot;</span>)</span><br><span class="line">    bool_value = rospy.get_param(<span class="string">&quot;p_bool&quot;</span>)</span><br><span class="line">    string_value = rospy.get_param(<span class="string">&quot;p_string&quot;</span>)</span><br><span class="line">    p_list = rospy.get_param(<span class="string">&quot;p_list&quot;</span>)</span><br><span class="line">    p_dict = rospy.get_param(<span class="string">&quot;p_dict&quot;</span>)</span><br><span class="line"></span><br><span class="line">    rospy.loginfo(<span class="string">&quot;获取的数据:%d,%.2f,%d,%s&quot;</span>,</span><br><span class="line">                int_value,</span><br><span class="line">                double_value,</span><br><span class="line">                bool_value,</span><br><span class="line">                string_value)</span><br><span class="line">    <span class="keyword">for</span> ele <span class="keyword">in</span> p_list:</span><br><span class="line">        rospy.loginfo(<span class="string">&quot;ele = %s&quot;</span>, ele)</span><br><span class="line"></span><br><span class="line">    rospy.loginfo(<span class="string">&quot;name = %s, age = %d&quot;</span>,p_dict[<span class="string">&quot;name&quot;</span>],p_dict[<span class="string">&quot;age&quot;</span>])</span><br><span class="line"></span><br><span class="line">    <span class="comment"># get_param_cached（效率比get_param高）</span></span><br><span class="line">    int_cached = rospy.get_param_cached(<span class="string">&quot;p_int&quot;</span>)</span><br><span class="line">    rospy.loginfo(<span class="string">&quot;缓存数据:%d&quot;</span>,int_cached)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># get_param_names</span></span><br><span class="line">    names = rospy.get_param_names()</span><br><span class="line">    <span class="keyword">for</span> name <span class="keyword">in</span> names:</span><br><span class="line">        rospy.loginfo(<span class="string">&quot;name = %s&quot;</span>,name)</span><br><span class="line"></span><br><span class="line">    rospy.loginfo(<span class="string">&quot;-&quot;</span>*<span class="number">80</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 判断某个键是否存在：has_param</span></span><br><span class="line">    flag = rospy.has_param(<span class="string">&quot;p_int&quot;</span>)</span><br><span class="line">    rospy.loginfo(<span class="string">&quot;包含p_int吗？%d&quot;</span>,flag)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 判断键是否存在，存在则返回键名：search_param</span></span><br><span class="line">    key = rospy.search_param(<span class="string">&quot;p_int&quot;</span>)</span><br><span class="line">    rospy.loginfo(<span class="string">&quot;搜索的键 = %s&quot;</span>,key)</span><br></pre></td></tr></table></figure>

<p>（3）删除参数：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># delete_param</span></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    rospy.init_node(<span class="string">&quot;delete_param_p&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        rospy.delete_param(<span class="string">&quot;p_int&quot;</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        rospy.loginfo(<span class="string">&quot;删除失败&quot;</span>)</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="五、常用命令"><a href="#五、常用命令" class="headerlink" title="五、常用命令"></a>五、常用命令</h4><p>以下介绍的命令都可以<strong>直接在命令行中实现</strong>，不需要创建节点；但缺点是<strong>不能包含太复杂的逻辑</strong>，只能做一些简单的实现（比如往参数服务器里添加参数、rostopic pub发布简单的话题）</p>
<p>1.rosnode</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">rosnode ping  xxx   <span class="comment">#测试到节点的连接状态</span></span><br><span class="line">rosnode <span class="built_in">list</span>    <span class="comment">#列出活动节点</span></span><br><span class="line">rosnode info  xxx    <span class="comment">#打印节点信息</span></span><br><span class="line">rosnode machine    <span class="comment">#列出指定设备上节点</span></span><br><span class="line">rosnode kill  xxx    <span class="comment">#杀死某个节点</span></span><br><span class="line">rosnode cleanup     <span class="comment">#清除不可连接的节点</span></span><br></pre></td></tr></table></figure>

<p>2.rostopic</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">rostopic <span class="built_in">list</span>   <span class="comment">#显示所有活动状态下的主题</span></span><br><span class="line">rostopic echo   <span class="comment">#打印话题消息到屏幕  rostopic  echo  /turtle1/cmd_vel</span></span><br><span class="line">rostopic pub    <span class="comment">#将数据发布到主题</span></span><br><span class="line">rostopic bw     <span class="comment">#显示主题使用的带宽</span></span><br><span class="line">rostopic delay  <span class="comment">#显示带有 header 的主题延迟</span></span><br><span class="line">rostopic find   <span class="comment">#根据类型查找主题</span></span><br><span class="line">rostopic hz     <span class="comment">#显示主题的发布频率</span></span><br><span class="line">rostopic info   <span class="comment">#显示主题相关信息</span></span><br><span class="line">rostopic <span class="built_in">type</span>   <span class="comment">#打印主题类型</span></span><br></pre></td></tr></table></figure>

<p>3.rosmsg</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">rosmsg show   <span class="comment"># 显示消息描述</span></span><br><span class="line">rosmsg info    <span class="comment">#显示消息信息</span></span><br><span class="line">rosmsg <span class="built_in">list</span>    <span class="comment">#列出所有消息</span></span><br><span class="line">rosmsg md5    <span class="comment">#显示 md5 加密后的消息</span></span><br><span class="line">rosmsg package    <span class="comment">#显示某个功能包下的所有消息</span></span><br><span class="line">rosmsg packages    <span class="comment">#列出包含消息的功能包</span></span><br></pre></td></tr></table></figure>

<p>4.rosservice</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">rosservice args  <span class="comment">#打印服务参数</span></span><br><span class="line">rosservice call    <span class="comment">#使用提供的参数调用服务</span></span><br><span class="line">rosservice find    <span class="comment">#按照服务类型查找服务</span></span><br><span class="line">rosservice info    <span class="comment">#打印有关服务的信息</span></span><br><span class="line">rosservice <span class="built_in">list</span>     <span class="comment">#列出所有活动的服务</span></span><br><span class="line">rosservice <span class="built_in">type</span>    <span class="comment">#打印服务类型</span></span><br><span class="line">rosservice uri     <span class="comment">#打印服务的 ROSRPC uri</span></span><br></pre></td></tr></table></figure>

<p>5.rossrv</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">rossrv show    <span class="comment">#显示服务消息详情</span></span><br><span class="line">rossrv info    <span class="comment">#显示服务消息相关信息</span></span><br><span class="line">rossrv <span class="built_in">list</span>    <span class="comment">#列出所有服务信息</span></span><br><span class="line">rossrv md5    <span class="comment">#显示 md5 加密后的服务消息</span></span><br><span class="line">rossrv package    <span class="comment">#显示某个包下所有服务消息</span></span><br><span class="line">rossrv packages    <span class="comment">#显示包含服务消息的所有包</span></span><br></pre></td></tr></table></figure>

<p>6.rosparam</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">rosparam <span class="built_in">set</span>    <span class="comment">#设置参数  rosparam set name xiaohuang</span></span><br><span class="line">rosparam get    <span class="comment">#获取参数</span></span><br><span class="line">rosparam load    <span class="comment">#从外部文件加载参数  ---&gt;反序列化</span></span><br><span class="line">rosparam dump    <span class="comment">#将参数写出到外部文件(yaml文件) ---&gt;序列化</span></span><br><span class="line">rosparam delete    <span class="comment">#删除参数</span></span><br><span class="line">rosparam <span class="built_in">list</span>    <span class="comment">#列出所有参数</span></span><br></pre></td></tr></table></figure>



<h4 id="六、实操"><a href="#六、实操" class="headerlink" title="六、实操"></a>六、实操</h4><p>1.乌龟<strong>控制节点</strong>实操举例：</p>
<ul>
<li>自己编写乌龟控制节点，实现乌龟的圆周运动。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rqt_graph   <span class="comment">#通过计算图查看话题名称</span></span><br><span class="line">rostopic <span class="built_in">type</span> /turtle1/cmd_vel  <span class="comment">#查看话题信息，获知消息类型为geometry_msgs/Twist</span></span><br><span class="line">rosmsg info geometry_msgs/Twist  <span class="comment">#查看消息格式</span></span><br></pre></td></tr></table></figure>

<p>消息格式：</p>
<p>geometry_msgs/Vector3 linear<br>  float64 x<br>  float64 y<br>  float64 z<br>geometry_msgs/Vector3 angular<br>  float64 x<br>  float64 y<br>  float64 z</p>
<p>linear线速度，xyz分别对应在x、y和z方向上的速度(单位是 m/s)；</p>
<p>angular角速度，xyz分别对应x轴上的<strong>翻滚</strong>、y轴上<strong>俯仰</strong>和z轴上<strong>偏航</strong>的速度(单位是rad/s)</p>
<p>偏航、翻滚与俯仰（RPY）：</p>
<img src="/images/image-20210414142557153.png" alt="image-20210414142557153" style="zoom:50%;">



<ul>
<li>实现控制节点（话题发布节点）</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">  <span class="comment">##将控制乌龟做圆周运动</span></span><br><span class="line">    </span><br><span class="line">  <span class="comment">#1.获取topic(已知: /turtle1/cmd_vel)</span></span><br><span class="line">  <span class="comment">#2.获取消息类型(已知: geometry_msgs/Twist)</span></span><br><span class="line">  <span class="comment">#3.运行前，注意先启动 turtlesim_node 节点</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">from</span> geometry_msgs.msg <span class="keyword">import</span> Twist</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment"># 2.初始化 ROS 节点</span></span><br><span class="line">    rospy.init_node(<span class="string">&quot;control_circle_p&quot;</span>)</span><br><span class="line">    <span class="comment"># 3.创建发布者对象</span></span><br><span class="line">    pub = rospy.Publisher(<span class="string">&quot;/turtle1/cmd_vel&quot;</span>,Twist,queue_size=<span class="number">1000</span>)</span><br><span class="line">    <span class="comment"># 4.循环发布运动控制消息</span></span><br><span class="line">    rate = rospy.Rate(<span class="number">10</span>)</span><br><span class="line">    msg = Twist()</span><br><span class="line">    msg.linear.x = <span class="number">1.0</span>    <span class="comment">#不能横着走</span></span><br><span class="line">    msg.linear.y = <span class="number">0.0</span></span><br><span class="line">    msg.linear.z = <span class="number">0.0</span></span><br><span class="line">    msg.angular.x = <span class="number">0.0</span></span><br><span class="line">    msg.angular.y = <span class="number">0.0</span></span><br><span class="line">    msg.angular.z = <span class="number">0.5</span>   <span class="comment">#只能偏航        </span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> rospy.is_shutdown():</span><br><span class="line">        pub.publish(msg)</span><br><span class="line">        rate.sleep()</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#自定义的节点编写好之后：</span></span><br><span class="line"><span class="comment">#三个终端中：</span></span><br><span class="line">roscore</span><br><span class="line">rosrun  turtlesim  turtlesim_node  </span><br><span class="line">rosrun  &lt;自定义的功能包&gt;  &lt;编写的节点文件名&gt;</span><br></pre></td></tr></table></figure>



<p>2.乌龟<strong>位姿信息订阅</strong>节点实操</p>
<p>已知turtlesim_node的位姿消息类型为：turtlesim/Pose</p>
<p>float32 x<br>float32 y<br>float32 theta<br>float32 linear_velocity<br>float32 angular_velocity</p>
<p>位姿信息订阅节点的实现：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">#1.获取话题名称 /turtle1/pose</span></span><br><span class="line"> <span class="comment">#2.获取消息类型 turtlesim/Pose</span></span><br><span class="line"> <span class="comment">#3.运行前启动 turtlesim_node 与 turtle_teleop_key 节点</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">from</span> turtlesim.msg <span class="keyword">import</span> Pose</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">doPose</span>(<span class="params">data</span>):</span></span><br><span class="line">    rospy.loginfo(<span class="string">&quot;乌龟坐标:x=%.2f, y=%.2f,theta=%.2f&quot;</span>,data.x,data.y,data.theta)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2.初始化 ROS 节点</span></span><br><span class="line">    rospy.init_node(<span class="string">&quot;sub_pose_p&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 3.创建订阅者对象</span></span><br><span class="line">    sub = rospy.Subscriber(<span class="string">&quot;/turtle1/pose&quot;</span>,Pose,doPose,queue_size=<span class="number">1000</span>)</span><br><span class="line">    <span class="comment">#     4.回调函数处理订阅的数据</span></span><br><span class="line">    <span class="comment">#     5.spin</span></span><br><span class="line">    rospy.spin()</span><br></pre></td></tr></table></figure>



<p>3.（服务通信）指定位置添加turtle的<strong>服务端请求</strong>实现：</p>
<p>服务也是基于话题的，所以首先是查看话题的消息类型：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 新增乌龟的话题是/spawn</span></span><br><span class="line">rosservice <span class="built_in">type</span> /spawn  <span class="comment">#获取消息类型为turtlesim/Spawn</span></span><br><span class="line">rossrv info turtlesim/Spawn  <span class="comment">#获取消息格式</span></span><br></pre></td></tr></table></figure>

<p>节点的实现大同小异，略</p>
<p>4.（参数服务器）参数设置</p>
<p>可通过launch文件传参，后面再介绍。</p>
<h4 id="七、常用API（python实现）"><a href="#七、常用API（python实现）" class="headerlink" title="七、常用API（python实现）"></a>七、常用API（python实现）</h4><p>1.节点初始化</p>
<p>重点在于anonymous参数的使用：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rospy.init_node(<span class="string">&quot;happy_node&quot;</span>, anonymous=<span class="literal">True</span>)    <span class="comment">#anonymous = true 时，为节点名称后缀随机编号</span></span><br><span class="line">                                                                                                             <span class="comment">#这样就可重复启动节点了！</span></span><br></pre></td></tr></table></figure>

<p>2.话题与服务相关对象</p>
<p>Publisher、Subscriber、Server、Client的创建，publish操作等</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#需要就查</span></span><br></pre></td></tr></table></figure>

<p>3.回调函数</p>
<p>相比C++，没有spinOnce( )函数，只有spin( )函数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rospy.spin( )</span><br></pre></td></tr></table></figure>



<p>4.时间</p>
<p>（1）获取、设置时刻</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取当前时刻</span></span><br><span class="line">right_now = rospy.Time.now()  <span class="comment">#rospy中有Time库，获取的是相对于1970年1月1日的时间</span></span><br><span class="line">rospy.loginfo(<span class="string">&quot;当前时刻:%.2f&quot;</span>,right_now.to_sec())  <span class="comment">#设置输出日志log</span></span><br><span class="line">rospy.loginfo(<span class="string">&quot;当前时刻:%.2f&quot;</span>,right_now.to_nsec())</span><br><span class="line"></span><br><span class="line"><span class="comment"># 自定义时刻</span></span><br><span class="line">some_time1 = rospy.Time(<span class="number">1234.567891011</span>)  <span class="comment">#some_time1是从1970.1.1的0时0分0秒开始往后1234.567891011秒</span></span><br><span class="line">some_time2 = rospy.Time(<span class="number">1234</span>,<span class="number">567891011</span>)</span><br><span class="line">rospy.loginfo(<span class="string">&quot;设置时刻1:%.2f&quot;</span>,some_time1.to_sec())</span><br><span class="line">rospy.loginfo(<span class="string">&quot;设置时刻2:%.2f&quot;</span>,some_time2.to_sec())</span><br></pre></td></tr></table></figure>

<p>（2）持续时间</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">du = rospy.Duration(<span class="number">3.3</span>)</span><br><span class="line"></span><br><span class="line">rospy.loginfo(<span class="string">&quot;du1 持续时间:%.2f&quot;</span>,du.to_sec())</span><br><span class="line">rospy.sleep(du) <span class="comment">#休眠函数</span></span><br><span class="line">rospy.loginfo(<span class="string">&quot;持续时间测试结束.....&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>（3）持续时间与时刻的运算</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">now = rospy.Time.now()</span><br><span class="line">du1 = rospy.Duration(<span class="number">10</span>)</span><br><span class="line">du2 = rospy.Duration(<span class="number">20</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#运算</span></span><br><span class="line">before_now = now - du1</span><br><span class="line">after_now = now + du1</span><br><span class="line">dd = du1 + du2</span><br><span class="line"><span class="comment"># now = now + now  #非法</span></span><br><span class="line">rospy.loginfo(<span class="string">&quot;之前时刻:%.2f&quot;</span>,before_now.to_sec())</span><br><span class="line">rospy.loginfo(<span class="string">&quot;之后时刻:%.2f&quot;</span>,after_now.to_sec())</span><br><span class="line">rospy.loginfo(<span class="string">&quot;持续时间相加:%.2f&quot;</span>,dd.to_sec())</span><br></pre></td></tr></table></figure>

<p><strong>（4）设置运行频率</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#通过rate.sleep( )实现，隔某段时间执行某种操作</span></span><br><span class="line"></span><br><span class="line">rate = rospy.Rate(<span class="number">0.5</span>)</span><br><span class="line"><span class="keyword">while</span> <span class="keyword">not</span> rospy.is_shutdown():</span><br><span class="line">    rate.sleep() <span class="comment">#休眠</span></span><br><span class="line">    rospy.loginfo(<span class="string">&quot;+++++++++++++++&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>（5）定时器，类似于rospy.Rate的功能：<strong>隔某段时间执行某种操作</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">rospy.Timer(rospy.Duration(<span class="number">1</span>),doMsg)   <span class="comment">#每隔1s，执行回调函数doMsg</span></span><br><span class="line">rospy.spin()</span><br><span class="line"></span><br><span class="line">rospy.Timer(rospy.Duration(<span class="number">1</span>),doMsg,<span class="literal">True</span>)  <span class="comment"># 只执行一次</span></span><br><span class="line">rospy.spin()</span><br></pre></td></tr></table></figure>

<p>（6）节点判断与关闭</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#节点状态判断</span></span><br><span class="line">rospy.is_shutdown()</span><br><span class="line"></span><br><span class="line"><span class="comment">#节点关闭函数</span></span><br><span class="line">rospy.signal_shutdown(<span class="string">&quot;不想用了&quot;</span>)  <span class="comment">#传参是字符串，说明关闭原因</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#关闭节点，同时执行回调函数</span></span><br><span class="line">rospy.on_shutdown(doMsg)</span><br></pre></td></tr></table></figure>

<p><strong>（7）日志函数</strong>：相当于实时打印一些提示信息</p>
<p>日志相关的函数也是极其常用的，在ROS中日志被划分成如下级别：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">rospy.logdebug(<span class="string">&quot;hello,debug&quot;</span>)  <span class="comment">#不会输出到控制台，调试时常用</span></span><br><span class="line">rospy.loginfo(<span class="string">&quot;hello,info&quot;</span>)  <span class="comment">#标准消息，默认白色字体</span></span><br><span class="line">rospy.logwarn(<span class="string">&quot;hello,warn&quot;</span>)  <span class="comment">#提醒一些异常情况，默认黄色字体</span></span><br><span class="line">rospy.logerr(<span class="string">&quot;hello,error&quot;</span>)  <span class="comment">#提示错误信息，默认红色字体</span></span><br><span class="line">rospy.logfatal(<span class="string">&quot;hello,fatal&quot;</span>) <span class="comment">#此类错误将阻止节点继续运行，默认红色字体</span></span><br></pre></td></tr></table></figure>



<p><strong>5.python模块导入</strong></p>
<p>先编写自定义模块文件（相当于C++头文件）：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># tools.py文件</span></span><br><span class="line"></span><br><span class="line">num=<span class="number">1000</span></span><br></pre></td></tr></table></figure>

<p>另一个python文件中调用模块A：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tools</span><br><span class="line">rospy.loginfo(<span class="string">&quot;num = %d&quot;</span>,tools.num)</span><br></pre></td></tr></table></figure>

<p>如果直接import新写的模块，会报错</p>
<p>原因：rosrun执行时，参考路径是workspace的路径，在workspace下无法查找到依赖的模块</p>
<p>解决：先声明环境变量</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="comment">#为了增加代码的可移植性，用os自动获取当前路径的前一级</span></span><br><span class="line">path = os.path.abspath(<span class="string">&quot;.&quot;</span>)</span><br><span class="line">sys.path.insert(<span class="number">0</span>, path + <span class="string">&quot;/src/plumbing_pub_sub/scripts&quot;</span>)  <span class="comment">#将模块文件所在路径添加到sys.path中</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> tools    </span><br><span class="line">rospy.loginfo(<span class="string">&quot;num = %d&quot;</span>,tools.num)  </span><br></pre></td></tr></table></figure>


            


        </div>
    </div>
    <div id="post-footer" class="post-footer main-content-wrap">
        
        
            <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2021/04/17/%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0ROS%EF%BC%88%E4%BA%8C%EF%BC%89/"
                    data-tooltip="系统学习ROS（二）"
                    aria-label="PREVIOUS: 系统学习ROS（二）"
                >
                    
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="hide-xs hide-sm text-small icon-ml">PREVIOUS</span>
                    </a>
            </li>
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2021/04/12/ROS%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%9A%E5%8F%A4%E6%9C%88%E5%B1%85%E5%85%A5%E9%97%A821%E8%AE%B2/"
                    data-tooltip="ROS学习笔记：古月居入门21讲"
                    aria-label="NEXT: ROS学习笔记：古月居入门21讲"
                >
                    
                        <span class="hide-xs hide-sm text-small icon-mr">NEXT</span>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a
                class="post-action-btn btn btn--default btn-open-shareoptions"
                href="#btn-open-shareoptions"
                aria-label="Share this post"
            >
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.facebook.com/sharer/sharer.php?u=http://example.com/2021/04/14/%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0ROS%EF%BC%88%E4%B8%80%EF%BC%89/"
                    title="Share on Facebook"
                    aria-label="Share on Facebook"
                >
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://twitter.com/intent/tweet?text=http://example.com/2021/04/14/%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0ROS%EF%BC%88%E4%B8%80%EF%BC%89/"
                    title="Share on Twitter"
                    aria-label="Share on Twitter"
                >
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://plus.google.com/share?url=http://example.com/2021/04/14/%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0ROS%EF%BC%88%E4%B8%80%EF%BC%89/"
                    title="Share on Google+"
                    aria-label="Share on Google+"
                >
                    <i class="fab fa-google-plus" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="Back to top">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


        
        
            
        
    </div>
</article>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2021 Eric Tan. All Rights Reserved.
    </span>
</footer>

            </div>
            
                <div id="bottom-bar" class="post-bottom-bar" data-behavior="4">
                    <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2021/04/17/%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0ROS%EF%BC%88%E4%BA%8C%EF%BC%89/"
                    data-tooltip="系统学习ROS（二）"
                    aria-label="PREVIOUS: 系统学习ROS（二）"
                >
                    
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="hide-xs hide-sm text-small icon-ml">PREVIOUS</span>
                    </a>
            </li>
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2021/04/12/ROS%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%9A%E5%8F%A4%E6%9C%88%E5%B1%85%E5%85%A5%E9%97%A821%E8%AE%B2/"
                    data-tooltip="ROS学习笔记：古月居入门21讲"
                    aria-label="NEXT: ROS学习笔记：古月居入门21讲"
                >
                    
                        <span class="hide-xs hide-sm text-small icon-mr">NEXT</span>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a
                class="post-action-btn btn btn--default btn-open-shareoptions"
                href="#btn-open-shareoptions"
                aria-label="Share this post"
            >
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.facebook.com/sharer/sharer.php?u=http://example.com/2021/04/14/%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0ROS%EF%BC%88%E4%B8%80%EF%BC%89/"
                    title="Share on Facebook"
                    aria-label="Share on Facebook"
                >
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://twitter.com/intent/tweet?text=http://example.com/2021/04/14/%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0ROS%EF%BC%88%E4%B8%80%EF%BC%89/"
                    title="Share on Twitter"
                    aria-label="Share on Twitter"
                >
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://plus.google.com/share?url=http://example.com/2021/04/14/%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0ROS%EF%BC%88%E4%B8%80%EF%BC%89/"
                    title="Share on Google+"
                    aria-label="Share on Google+"
                >
                    <i class="fab fa-google-plus" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="Back to top">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


                </div>
                
    <div id="share-options-bar" class="share-options-bar" data-behavior="4">
        <i id="btn-close-shareoptions" class="fa fa-times"></i>
        <ul class="share-options">
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://www.facebook.com/sharer/sharer.php?u=http://example.com/2021/04/14/%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0ROS%EF%BC%88%E4%B8%80%EF%BC%89/"
                        aria-label="Share on Facebook"
                    >
                        <i class="fab fa-facebook" aria-hidden="true"></i><span>Share on Facebook</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://twitter.com/intent/tweet?text=http://example.com/2021/04/14/%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0ROS%EF%BC%88%E4%B8%80%EF%BC%89/"
                        aria-label="Share on Twitter"
                    >
                        <i class="fab fa-twitter" aria-hidden="true"></i><span>Share on Twitter</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://plus.google.com/share?url=http://example.com/2021/04/14/%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0ROS%EF%BC%88%E4%B8%80%EF%BC%89/"
                        aria-label="Share on Google+"
                    >
                        <i class="fab fa-google-plus" aria-hidden="true"></i><span>Share on Google+</span>
                    </a>
                </li>
            
        </ul>
    </div>


            
        </div>
        


<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-times"></i>
        </div>
        
            <h4 id="about-card-name">Eric Tan</h4>
        
            <div id="about-card-bio"><p>author.bio</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>author.job</p>

            </div>
        
        
    </div>
</div>

        
        
<div id="cover" style="background-image:url('/assets/images/cover.jpg');"></div>
        <!--SCRIPTS-->

<script src="/assets/js/script-aruckjrapimnobkxs27htsu2kxkoy2szmjcde1n3gfjqfmv8qbkdebriarib.min.js"></script>

<!--SCRIPTS END-->


    




    </body>
</html>
