<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>系统学习ROS（二） | Eric Tan</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="ROS运行管理(launch文件等)  &amp;  ROS内置组件之TF功能包">
<meta property="og:type" content="article">
<meta property="og:title" content="系统学习ROS（二）">
<meta property="og:url" content="http://example.com/2021/04/17/%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0ROS%EF%BC%88%E4%BA%8C%EF%BC%89/index.html">
<meta property="og:site_name" content="Eric Tan">
<meta property="og:description" content="ROS运行管理(launch文件等)  &amp;  ROS内置组件之TF功能包">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2021-04-16T21:18:17.000Z">
<meta property="article:modified_time" content="2021-04-17T05:23:04.166Z">
<meta property="article:author" content="Eric Tan">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Eric Tan" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Eric Tan</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">Welcome, and thanks.</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-系统学习ROS（二）" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/04/17/%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0ROS%EF%BC%88%E4%BA%8C%EF%BC%89/" class="article-date">
  <time class="dt-published" datetime="2021-04-16T21:18:17.000Z" itemprop="datePublished">2021-04-17</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/ROS/">ROS</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      系统学习ROS（二）
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>ROS运行管理(launch文件等)  &amp;  ROS内置组件之TF功能包</p>
<span id="more"></span>

<p><strong>学习地址（全文参考）</strong>：<a target="_blank" rel="noopener" href="http://www.autolabor.com.cn/book/ROSTutorials/">http://www.autolabor.com.cn/book/ROSTutorials/</a></p>
<h4 id="八、ROS运行管理"><a href="#八、ROS运行管理" class="headerlink" title="八、ROS运行管理"></a>八、ROS运行管理</h4><p>1.元功能包</p>
<p>完成ROS中一个系统性的功能，可能涉及到多个功能包，在ROS中，提供了一种方式可以将不同的功能包打包成一个功能包，当安装某个功能模块时，直接调用打包后的功能包即可，该包又称之为元功能包(metapackage)。</p>
<p>即：元功能包是<strong>方便安装</strong>的。</p>
<p>实现：修改<code>package.xml</code> —&gt; 修改<code>CMakeList</code>          需要就查！</p>
<p><strong>2.launch文件</strong></p>
<p>launch 文件是一个 <strong>XML 格式</strong>的文件，可以启动本地和远程的多个节点，还可以在参数服务器中设置参数；简化节点的配置与启动，<strong>提高ROS程序的启动效率</strong>。</p>
<p>实现流程：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在功能包下新建launch文件夹</span></span><br><span class="line">      <span class="comment">#梳理一下，此时功能包下有哪些文件夹：include、src(.cpp)、scripts(.py)、launch</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">#在launch文件夹下新建demo.launch文件</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#调用launch文件</span></span><br><span class="line">roslaunch  功能包名  xxx.launch</span><br></pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;launch&gt;</span><br><span class="line">    &lt;node pkg=<span class="string">&quot;turtlesim&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;turtlesim_node&quot;</span>     name=<span class="string">&quot;myTurtle&quot;</span> output=<span class="string">&quot;screen&quot;</span> /&gt;</span><br><span class="line">    &lt;node pkg=<span class="string">&quot;turtlesim&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;turtle_teleop_key&quot;</span>  name=<span class="string">&quot;myTurtleContro&quot;</span> output=<span class="string">&quot;screen&quot;</span> /&gt;</span><br><span class="line">&lt;/launch&gt;</span><br></pre></td></tr></table></figure>

<p>（1）<launch>标签：</launch></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#属性</span></span><br><span class="line">&lt;launch deprecated = <span class="string">&quot;弃用声明&quot;</span>&gt;      <span class="comment">#表示该节点不用了</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#子集标签</span></span><br><span class="line">所有其他标签都是launch的子集</span><br></pre></td></tr></table></figure>

<p>（2）<node>标签：</node></p>
<p>用于指定 ROS 节点，是最常见的标签，需要注意的是: roslaunch 命令<strong>不能保证按照 node 的声明顺序</strong>来启动节点(节点的启动是多进程的)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#属性</span></span><br><span class="line">   pkg=<span class="string">&quot;包名&quot;</span>   <span class="comment">#节点所属的包</span></span><br><span class="line">   <span class="built_in">type</span>=<span class="string">&quot;nodeType&quot;</span>   <span class="comment">#节点类型(与之相同名称的可执行文件) = 节点名</span></span><br><span class="line">   name=<span class="string">&quot;nodeName&quot;</span>   <span class="comment">#节点名称(在 ROS 网络拓扑中节点的名称)，  随便设置，相当于给节点重命名</span></span><br><span class="line">   args=<span class="string">&quot;xxx xxx xxx&quot;</span>       <span class="comment">#(可选)将参数传递给节点</span></span><br><span class="line">   machine=<span class="string">&quot;机器名&quot;</span>      <span class="comment">#在指定机器上启动节点</span></span><br><span class="line">   </span><br><span class="line">   respawn=<span class="string">&quot;true | false&quot;</span>         <span class="comment">#(可选) 如果节点退出，是否自动重启   ---&gt; 例如激光雷达，不能因为意外关闭而停止，所以可为它设置该属性</span></span><br><span class="line">   respawn_delay=<span class="string">&quot; N&quot;</span>         <span class="comment">#(可选) 如果 respawn 为 true, 那么延迟 N 秒后启动节点</span></span><br><span class="line">   </span><br><span class="line">   required=<span class="string">&quot;true | false&quot;</span>        <span class="comment">#(可选)该节点是否必须，如果为 true,那么如果该节点退出，将杀死整个 roslaunch</span></span><br><span class="line">   ns=<span class="string">&quot;xxx&quot;</span>         <span class="comment">#(可选) 在指定命名空间 xxx 中启动节点  ---&gt; 在节点name前面加的前缀，也即命名空间  ---&gt;  避免重名问题</span></span><br><span class="line">   clear_params=<span class="string">&quot;true | false&quot;</span>   <span class="comment"># (可选)在启动前，删除节点的私有空间的所有参数</span></span><br><span class="line">   output=<span class="string">&quot;log | screen&quot;</span>       <span class="comment">#(可选)  日志发送目标，可以设置为 log 日志文件，或 screen 屏幕,默认是 log</span></span><br><span class="line"></span><br><span class="line">   </span><br><span class="line">   <span class="comment">#子集标签</span></span><br><span class="line">   env  <span class="comment">#环境变量设置</span></span><br><span class="line">   remap  <span class="comment">#重映射节点名称</span></span><br><span class="line">   rosparam  <span class="comment">#参数设置</span></span><br><span class="line">   param  <span class="comment">#参数设置</span></span><br></pre></td></tr></table></figure>

<p>（3）<include>标签</include></p>
<p>用于将另一个 xml 格式的 launch 文件导入到当前文件</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#属性</span></span><br><span class="line">   file=<span class="string">&quot;$(find 包名)/xxx/xxx.launch&quot;</span>   <span class="comment">#要包含的文件路径  </span></span><br><span class="line">   																		<span class="comment"># $&#123;find  包名&#125;是一种固定格式，自动寻找功能包所在路径，所以后面只需要给出launch文件在功能包下的相对路径即可</span></span><br><span class="line">  </span><br><span class="line">ns=<span class="string">&quot;xxx&quot;</span>    <span class="comment">#(可选) 在指定命名空间导入文件</span></span><br><span class="line"></span><br><span class="line">   </span><br><span class="line">   <span class="comment">#子集标签</span></span><br><span class="line">   env  <span class="comment">#环境变量设置</span></span><br><span class="line">   arg   <span class="comment">#将参数传递给被包含的文件</span></span><br></pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;launch&gt;</span><br><span class="line">   	&lt;include file=<span class="string">&quot;$&#123;find  功能包名&#125;/launch/demo1_turtle.launch&quot;</span> /&gt; </span><br><span class="line">       ...</span><br><span class="line">&lt;/launch&gt;</span><br></pre></td></tr></table></figure>



<p>（4）<remap>标签（非常实用）</remap></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#属性</span></span><br><span class="line">   <span class="keyword">from</span>=<span class="string">&quot;xxx&quot;</span>   <span class="comment">#原始话题名称</span></span><br><span class="line">   to=<span class="string">&quot;yyy&quot;</span>   <span class="comment">#目标名称</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">#子集标签</span></span><br><span class="line">   无</span><br></pre></td></tr></table></figure>

<ul>
<li>举例：乌龟键盘控制节点turtle_teleop_key局限性很大，通常使用<strong>ROS系统内置的键盘控制节点</strong>！</li>
</ul>
<p>问题：使用其他键盘控制节点，键盘发布速度控制信息，乌龟订阅信息，但是二者的话题不一样！！无法连接</p>
<p>​                键盘节点的话题名是/cmd_vel，乌龟节点的话题名是/turtle1/cmd_vel</p>
<ul>
<li>中一个话题名称，使用remap标签</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;launch&gt;</span><br><span class="line">		&lt;node pkg=<span class="string">&quot;turtlesim&quot;</span>  <span class="built_in">type</span>=<span class="string">&quot;turtlesim_node&quot;</span>  name=<span class="string">&quot;my_turtle&quot;</span>  output=<span class="string">&quot;screen&quot;</span>&gt;</span><br><span class="line">    				&lt;remap <span class="keyword">from</span>=<span class="string">&quot;/turtle1/cmd_vel&quot;</span>  to=<span class="string">&quot;/cmd_vel&quot;</span>  /&gt;  <span class="comment">#重映射话题名</span></span><br><span class="line">        &lt;/node&gt;  #使用了node子标签时，后面要用&lt;/node&gt;</span><br><span class="line"> &lt;/launch&gt;</span><br></pre></td></tr></table></figure>



<p>（5）<param>标签</p>
<p>用于在参数服务器上设置参数，参数源可以在标签中通过 <strong>value 指定</strong>，也可以通过<strong>外部文件加载</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#属性</span></span><br><span class="line">   name=<span class="string">&quot;命名空间/参数名&quot;</span>    <span class="comment">#参数名称</span></span><br><span class="line">   value=<span class="string">&quot;xxx&quot;</span>    <span class="comment">#(可选)定义参数值，如果此处省略，必须指定外部文件作为参数源</span></span><br><span class="line">   <span class="built_in">type</span>=<span class="string">&quot;str | int | double | bool | yaml&quot;</span>    <span class="comment">#(可选)  指定参数类型，如果未指定，roslaunch 会尝试确定参数类型，规则如下:</span></span><br><span class="line">                                                                                 <span class="comment">#如果包含 &#x27;.&#x27; 的数字解析未浮点型，否则为整型</span></span><br><span class="line">                                                                                 <span class="comment">#&quot;true&quot; 和 &quot;false&quot; 是 bool 值(不区分大小写)</span></span><br><span class="line">                                                                                 <span class="comment"># 其他是字符串</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#子集标签</span></span><br><span class="line">   无</span><br></pre></td></tr></table></figure>

<p>有<strong>两种方式</strong>使用param标签：</p>
<p>tip: 在node中设置会自动加上<strong>node的名称作为前缀</strong>，该前缀也成为<code>私有命名空间</code></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#方式1：在launch下，node外</span></span><br><span class="line">&lt;launch&gt;</span><br><span class="line">		&lt;param name=<span class="string">&quot;param_A&quot;</span>  <span class="built_in">type</span>=<span class="string">&quot;int&quot;</span>  value=<span class="string">&quot;100&quot;</span> /&gt;   <span class="comment">#参数名称为param_A</span></span><br><span class="line">    	&lt;node....&gt;</span><br><span class="line">&lt;/launch&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">#方式2：node下</span></span><br><span class="line">&lt;launch&gt;</span><br><span class="line">		&lt;node pkg=<span class="string">&quot;turtlesim&quot;</span>  <span class="built_in">type</span>=<span class="string">&quot;turtlesim_node&quot;</span>  name=<span class="string">&quot;my_turtle&quot;</span>  output=<span class="string">&quot;screen&quot;</span>&gt;</span><br><span class="line">    			&lt;param name=<span class="string">&quot;param_B&quot;</span>  <span class="built_in">type</span>=<span class="string">&quot;double&quot;</span>  value=<span class="string">&quot;3.14&quot;</span>  /&gt;   <span class="comment">#参数名称为my_turtle/param_B ,  即以node名称作为前缀</span></span><br><span class="line">        &lt;/node&gt;</span><br><span class="line">&lt;/launch&gt;</span><br></pre></td></tr></table></figure>



<p>（6）<rosparam>标签</rosparam></p>
<p>可以从 <strong>YAML 文件导入参数</strong>，或将参数导出到 YAML 文件，也可以用来删除参数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#属性</span></span><br><span class="line">   command=<span class="string">&quot;load | dump | delete&quot;</span>  <span class="comment">#(可选，默认 load)       </span></span><br><span class="line">   																	   <span class="comment">#加载、导出或删除参数</span></span><br><span class="line">   file=<span class="string">&quot;$(find xxxxx)/xxx/yyy....&quot;</span>  <span class="comment">#加载或导出到的 yaml 文件</span></span><br><span class="line">   param=<span class="string">&quot;参数名称&quot;</span></span><br><span class="line">   ns=<span class="string">&quot;命名空间&quot;</span>   <span class="comment">#(可选)</span></span><br></pre></td></tr></table></figure>

<p>rosparam也有两种方式：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#方式1：在launch下，node外</span></span><br><span class="line">&lt;launch&gt;</span><br><span class="line">		&lt;rosparam  command=<span class="string">&quot;load&quot;</span>  file= <span class="string">&quot;$&#123;find  demo_launch1&#125;/launch/param_test.yaml&quot;</span> /&gt;   <span class="comment">#从yaml文件加载参数</span></span><br><span class="line">    	&lt;node....&gt;</span><br><span class="line">&lt;/launch&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">#方式2：node下</span></span><br><span class="line">&lt;launch&gt;</span><br><span class="line">		&lt;node pkg=<span class="string">&quot;turtlesim&quot;</span>  <span class="built_in">type</span>=<span class="string">&quot;turtlesim_node&quot;</span>  name=<span class="string">&quot;my_turtle&quot;</span>  output=<span class="string">&quot;screen&quot;</span>&gt;</span><br><span class="line">    			&lt;rosparam  command=<span class="string">&quot;load&quot;</span>  file=<span class="string">&quot;$&#123;find  demo_launch1&#125;/launch/param_test.yaml&quot;</span>  /&gt;   </span><br><span class="line">        &lt;/node&gt;</span><br><span class="line">&lt;/launch&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#导出参数dump</span></span><br><span class="line">&lt;launch&gt;</span><br><span class="line">		&lt;rosparam  command=<span class="string">&quot;dump&quot;</span>  file= <span class="string">&quot;$&#123;find  demo_launch1&#125;/launch/param_out.yaml&quot;</span> /&gt;   </span><br><span class="line">&lt;/launch&gt;</span><br></pre></td></tr></table></figure>

<p>注：导出文件的rosparam标签不能放在节点启动文件中，因为rosparam启动的优先级最高，所以会在node启动之前就导出参数，使得很多参数无法导出；因此通常做法：将dump<strong>写入一个新的launch文件</strong>。</p>
<p>（8）<group>标签</group></p>
<p>对<strong>节点分组</strong>，具有 ns 属性，可以让节点归属某个命名空间</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#属性</span></span><br><span class="line">   ns=<span class="string">&quot;名称空间&quot;</span>   <span class="comment">#(可选)</span></span><br><span class="line">   clear_params=<span class="string">&quot;true | false&quot;</span>   <span class="comment">#(可选)启动前，是否删除组名称空间的所有参数(慎用....此功能危险)</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">#子标签</span></span><br><span class="line">   除了launch 标签外的其他标签</span><br></pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#启动两对乌龟、键盘控制节点，使他们不产生命名冲突</span></span><br><span class="line">&lt;launch&gt;</span><br><span class="line">		&lt;group  ns=<span class="string">&quot;first&quot;</span>&gt;   <span class="comment">#第一个分组，命名空间是first</span></span><br><span class="line">    			&lt;node  pkg=<span class="string">&quot;turtlesim&quot;</span>  <span class="built_in">type</span>=<span class="string">&quot;turtlesim_node&quot;</span>  name=<span class="string">&quot;my_turtle&quot;</span>  output=<span class="string">&quot;screen&quot;</span>  /&gt;</span><br><span class="line">        		&lt;node  pkg=<span class="string">&quot;turtlesim&quot;</span>  <span class="built_in">type</span>=<span class="string">&quot;turtle_teleop_key&quot;</span>  name=<span class="string">&quot;my_key&quot;</span>  output=<span class="string">&quot;screen&quot;</span>  /&gt;</span><br><span class="line">        &lt;/group&gt;</span><br><span class="line">        &lt;group  ns=<span class="string">&quot;second&quot;</span>&gt;   <span class="comment">#第二个分组，命名空间是second</span></span><br><span class="line">        		&lt;node  pkg=<span class="string">&quot;turtlesim&quot;</span>  <span class="built_in">type</span>=<span class="string">&quot;turtlesim_node&quot;</span>  name=<span class="string">&quot;my_turtle&quot;</span>  output=<span class="string">&quot;screen&quot;</span>  /&gt;</span><br><span class="line">           		 &lt;node  pkg=<span class="string">&quot;turtlesim&quot;</span>  <span class="built_in">type</span>=<span class="string">&quot;turtle_teleop_key&quot;</span>  name=<span class="string">&quot;my_key&quot;</span>  output=<span class="string">&quot;screen&quot;</span>  /&gt;</span><br><span class="line">        &lt;/group&gt;</span><br><span class="line">&lt;/launch&gt;</span><br></pre></td></tr></table></figure>

<p>（9）<arg>标签</arg></p>
<p>用于<strong>动态传参</strong>，类似于<strong>函数的参数</strong>，可以增强launch文件的灵活性</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#属性</span></span><br><span class="line">   name=<span class="string">&quot;参数名称&quot;</span></span><br><span class="line">   default=<span class="string">&quot;默认值&quot;</span>    <span class="comment">#(可选)</span></span><br><span class="line">   value=<span class="string">&quot;数值&quot;</span>    <span class="comment">#(可选) 不可以与 default 并存</span></span><br><span class="line">   doc=<span class="string">&quot;描述&quot;</span>   <span class="comment">#参数说明</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#子标签</span></span><br><span class="line">   无</span><br></pre></td></tr></table></figure>

<p>arg的作用：可以理解为方便<strong>参数复用</strong>，在小程序中无法体现其优越性，在<strong>复杂的机器人项目中其优势才得以体现</strong></p>
<p>假如我现在要设置三个参数A、B、C，它们都记录了同一个小车的尺寸：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#不使用arg标签</span></span><br><span class="line">&lt;launch&gt;</span><br><span class="line">		&lt;param  name=<span class="string">&quot;A&quot;</span>  value=<span class="string">&quot;0.6&quot;</span>   /&gt;</span><br><span class="line"> 	    &lt;param  name=<span class="string">&quot;B&quot;</span>  value=<span class="string">&quot;0.6&quot;</span>   /&gt;</span><br><span class="line">   	    &lt;param  name=<span class="string">&quot;C&quot;</span>  value=<span class="string">&quot;0.6&quot;</span>   /&gt;</span><br><span class="line">&lt;/launch&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#使用arg标签</span></span><br><span class="line">&lt;launch&gt;</span><br><span class="line">		&lt;arg  name=<span class="string">&quot;car_length&quot;</span>  default=<span class="string">&quot;0.5&quot;</span>  /&gt;</span><br><span class="line">    	</span><br><span class="line">        &lt;param  name=<span class="string">&quot;A&quot;</span>  value=<span class="string">&quot;$(arg  car_length)&quot;</span>   /&gt;  <span class="comment">#调用参数car_length</span></span><br><span class="line"> 	    &lt;param  name=<span class="string">&quot;B&quot;</span>  value=<span class="string">&quot;$(arg  car_length)&quot;</span>   /&gt;</span><br><span class="line">   	    &lt;param  name=<span class="string">&quot;C&quot;</span>  value=<span class="string">&quot;$(arg  car_length)&quot;</span>   /&gt;</span><br><span class="line"> &lt;/launch&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">#体会arg的好处： 如果要更改小车尺寸，不用到冗长的launch文件里一个一个找、一个一个改，</span></span><br><span class="line">                                    <span class="comment">#只用修改arg一处即可！</span></span><br></pre></td></tr></table></figure>



<p><strong>3.重名问题</strong></p>
<p>（1）功能包重名 —— “工作空间覆盖”</p>
<ul>
<li><p>说明：</p>
<p>自定义工作空间的功能包与<strong>内置的功能包</strong>可以重名或者<strong>不同的自定义的工作空间中</strong>也可以出现重名的功能包；</p>
<p>优先级：ROS 会解析 .bashrc 文件，并生成 ROS_PACKAGE_PATH ROS包路径，该变量中按照 .bashrc  中配置设置工作空间优先级，在设置时需要遵循一定的原则:ROS_PACKAGE_PATH 中的值，和 .bashrc  的配置顺序相反—&gt;后配置的优先级更高</p>
<p>功能包重名时，会按照 ROS_PACKAGE_PATH 查找，配置在前的会优先执行。</p>
</li>
</ul>
<p>每种问题都有3种途径：<strong>1.rosrun命令  2.launch文件  3.编码实现</strong></p>
<p><strong>（2）节点重名</strong></p>
<p>解决方法：1.重映射  2.加前缀(命名空间)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#rosrun命令</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#1.设置命名空间  __ns:=</span></span><br><span class="line">rosrun 包名 节点名 __ns:=新名称</span><br><span class="line">rosrun  turtlesim  turtlesim_node   __ns:=/xxx</span><br><span class="line">    </span><br><span class="line"><span class="comment">#2.重映射别名  __name:=</span></span><br><span class="line">rosrun 包名 节点名   __name:=新名称</span><br><span class="line">rosrun turtlesim  turtlesim_node   __name:=t1</span><br><span class="line">rosrun turtlesim  turtlesim_node   __name:=t2 </span><br><span class="line">    </span><br><span class="line"><span class="comment">#3.同时命名空间+重映射  __ns:=      __name:=</span></span><br><span class="line"> rosrun 包名 节点名   __ns:=新名称   __name:=新名称</span><br><span class="line"> rosrun  turtlesim  turtlesim_node   __ns:=/xxx   __name:=tn</span><br></pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#launch文件</span></span><br><span class="line">在 node 标签中有两个属性: name 和 ns，二者分别是用于实现名称重映射与命名空间设置的</span><br><span class="line"></span><br><span class="line">&lt;launch&gt;</span><br><span class="line"></span><br><span class="line">    &lt;node pkg=<span class="string">&quot;turtlesim&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;turtlesim_node&quot;</span> name=<span class="string">&quot;t1&quot;</span> /&gt;  <span class="comment">#重映射</span></span><br><span class="line">    &lt;node pkg=<span class="string">&quot;turtlesim&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;turtlesim_node&quot;</span> name=<span class="string">&quot;t2&quot;</span> /&gt;</span><br><span class="line">    &lt;node pkg=<span class="string">&quot;turtlesim&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;turtlesim_node&quot;</span> name=<span class="string">&quot;t1&quot;</span> ns=<span class="string">&quot;hello&quot;</span>/&gt;   <span class="comment">#重映射+命名空间</span></span><br><span class="line"></span><br><span class="line">&lt;/launch&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#编码实现</span></span><br><span class="line">如果自定义节点，则以更灵活的设置命名空间与重映射实现</span><br><span class="line">rospy.init_node(<span class="string">&quot;lisi&quot;</span>,anonymous=<span class="literal">True</span>)  <span class="comment">#会在节点名称后缀时间戳</span></span><br></pre></td></tr></table></figure>



<p><strong>（3）话题重名</strong></p>
<p>两个节点是<strong>可以通信</strong>的，两个节点之间使用了相同的消息类型，但是由于，话题名称不同，导致通信失败</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#rosrun命令</span></span><br><span class="line"> rorun 包名 节点名 话题名:=新话题名称</span><br><span class="line"> rosrun  turtlesim  turtlesim_node   /turtle1/cmd_vel:=/cmd_vel</span><br></pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#launch文件</span></span><br><span class="line">&lt;launch&gt;</span><br><span class="line"></span><br><span class="line">    &lt;node pkg=<span class="string">&quot;turtlesim&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;turtlesim_node&quot;</span> name=<span class="string">&quot;t1&quot;</span> /&gt;</span><br><span class="line">    &lt;node pkg=<span class="string">&quot;teleop_twist_keyboard&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;teleop_twist_keyboard.py&quot;</span> name=<span class="string">&quot;key&quot;</span>&gt;</span><br><span class="line">        &lt;remap <span class="keyword">from</span>=<span class="string">&quot;/cmd_vel&quot;</span> to=<span class="string">&quot;/turtle1/cmd_vel&quot;</span> /&gt;   <span class="comment">#&lt;remap from=&quot;原话题&quot; to=&quot;新话题&quot; /&gt;</span></span><br><span class="line">    &lt;/node&gt;</span><br><span class="line"></span><br><span class="line">&lt;/launch&gt;</span><br></pre></td></tr></table></figure>

<p><strong>话题名称</strong>的分类：</p>
<p>补充知识点（重要）：话题的名称与节点的命名空间、节点的名称是有一定关系的，<strong>话题名称</strong>大致可以分为三种类型</p>
<p>（如果有一个话题叫<code>liaotian</code>）：</p>
<ul>
<li>全局：参考ROS系统，<code>/liaotian</code>  /代表的是根目录  </li>
<li>相对：参考节点的命名空间， <code>/ergouzi/liaotian</code>  ergouzi是节点的命名空间  —&gt; 会以<code>节点的命名空间</code>作为前缀</li>
<li>私有：参考节点名称， <code>/ergouzi/wangqiang/liaotian</code>  wangqiang是节点名  —&gt; 会以<code>节点的命名空间+节点名</code>作为前缀</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#编码设置</span></span><br><span class="line">假设现在初始化节点时，传递一个 __ns:= xxx</span><br><span class="line">    </span><br><span class="line"><span class="comment">#1.全局</span></span><br><span class="line"><span class="comment">#话题命名为：以/开头的名称</span></span><br><span class="line">pub = rospy.Publisher(<span class="string">&quot;/chatter&quot;</span>,String,queue_size=<span class="number">1000</span>)  <span class="comment">#/chatter</span></span><br><span class="line">pub = rospy.Publisher(<span class="string">&quot;/chatter/money&quot;</span>,String,queue_size=<span class="number">1000</span>)  <span class="comment">#/chatter/money</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#2.相对</span></span><br><span class="line"><span class="comment">#话题命名为：非/开头的名称</span></span><br><span class="line">pub = rospy.Publisher(<span class="string">&quot;chatter&quot;</span>,String,queue_size=<span class="number">1000</span>)   <span class="comment">#xxx/chatter</span></span><br><span class="line">pub = rospy.Publisher(<span class="string">&quot;chatter/money&quot;</span>,String,queue_size=<span class="number">1000</span>)   <span class="comment">#xxx/chatter/money</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#3.私有</span></span><br><span class="line"><span class="comment">#话题命名为：以~开头的名称</span></span><br><span class="line">pub = rospy.Publisher(<span class="string">&quot;~chatter&quot;</span>,String,queue_size=<span class="number">1000</span>)   <span class="comment">#/xxx/hello/chatter</span></span><br><span class="line">pub = rospy.Publisher(<span class="string">&quot;~chatter/money&quot;</span>,String,queue_size=<span class="number">1000</span>)   <span class="comment">#/xxx/hello/chatter/money</span></span><br></pre></td></tr></table></figure>



<p><strong>（4）参数重名</strong></p>
<p>没有重映射实现，为了尽量的避免参数重名，都是使用为参数名<strong>添加前缀</strong>的方式，实现类似于话题名称。</p>
<p><strong>参数名称</strong>：也有<strong>全局、相对</strong>、和<strong>私有</strong>三种类型之分</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#rosrun</span></span><br><span class="line">rosrun 包名 节点名称 _参数名:=参数值</span><br><span class="line">rosrun turtlesim turtlesim_node _A:=<span class="number">100</span>   <span class="comment">#/turtlesim/A=100</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">#说名：执行rosrun时设置参数参数名使用的是私有模式</span></span><br></pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#launch文件</span></span><br><span class="line">前面已经介绍过，可以在 node 标签外，或 node 标签中通过 param 或 rosparam 来设置参数。</span><br><span class="line">在 node 标签外设置的参数是全局性质的，参考的是 / </span><br><span class="line">在 node 标签中设置的参数是私有性质的，参考的是 /命名空间/节点名称</span><br><span class="line"></span><br><span class="line">&lt;launch&gt;</span><br><span class="line"></span><br><span class="line">    &lt;param name=<span class="string">&quot;p1&quot;</span> value=<span class="string">&quot;100&quot;</span> /&gt;      <span class="comment">#/p1=100</span></span><br><span class="line">    &lt;node pkg=<span class="string">&quot;turtlesim&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;turtlesim_node&quot;</span> name=<span class="string">&quot;ergouzi&quot;</span>&gt;</span><br><span class="line">         &lt;param name=<span class="string">&quot;p2&quot;</span> value=<span class="string">&quot;100&quot;</span> /&gt;   <span class="comment">#/erigouzi/p1=100</span></span><br><span class="line">    &lt;/node&gt;</span><br><span class="line"></span><br><span class="line">&lt;/launch&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#编码方式</span></span><br><span class="line">编码的方式可以更方便的设置:全局、相对与私有参数</span><br><span class="line">    </span><br><span class="line">rospy.set_param函数中，参数<span class="number">1</span>传入参数名称，参数<span class="number">2</span>是传入参数值。参数<span class="number">1</span>中参数名称设置时：</span><br><span class="line">如果以 / 开头，那么就是全局参数</span><br><span class="line">如果以 ~ 开头，那么就是私有参数</span><br><span class="line">既不以 / 也不以 ~ 开头，那么就是相对参数</span><br><span class="line"></span><br><span class="line">rospy.set_param(<span class="string">&quot;/py_A&quot;</span>,<span class="number">100</span>)  <span class="comment">#全局</span></span><br><span class="line">rospy.set_param(<span class="string">&quot;py_B&quot;</span>,<span class="number">100</span>)  <span class="comment">#相对</span></span><br><span class="line">rospy.set_param(<span class="string">&quot;~py_C&quot;</span>,<span class="number">100</span>)  <span class="comment">#私有</span></span><br></pre></td></tr></table></figure>



<p><strong>4.ROS分布式通信</strong></p>
<p>一个运行中的ROS系统可以包含分布在<strong>多台计算机上多个节点</strong>。根据系统的配置方式，任何节点可能随时需要与任何其他节点进行通信。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#配置ip等等操作，需要就查</span></span><br></pre></td></tr></table></figure>





<h4 id="九、ROS内置组件"><a href="#九、ROS内置组件" class="headerlink" title="九、ROS内置组件"></a>九、ROS内置组件</h4><p>常用的内置组件：TF坐标变换、rosbag、rqt 工具箱</p>
<p><strong>1.TF坐标变换</strong></p>
<p>明确了不同坐标系之间的的相对关系，就可以实现任何坐标点在不同坐标系之间的转换，但是该计算实现是较为常用的，且算法也有点复杂。因此在 **ROS 中直接封装了相关的模块: 坐标变换(TF)**，我们不需要关心坐标变换是如何实现的，直接调用即可。</p>
<p>（1）坐标message</p>
<p>TF转换实现中常用的 msg:</p>
<p>注：<strong>最好记住这两个消息类型</strong>！因为TF中实现坐标转换都是使用这样的message</p>
<ul>
<li><code>geometry_msgs/TransformStamped</code>用于传输坐标系<strong>相对位置</strong>信息（涉及<strong>四元数</strong>概念，较难） </li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">std_msgs/Header header</span><br><span class="line">  uint32 seq</span><br><span class="line">  time stamp</span><br><span class="line">  string frame_id</span><br><span class="line">string child_frame_id</span><br><span class="line">geometry_msgs/Transform transform</span><br><span class="line">  geometry_msgs/Vector3 translation</span><br><span class="line">    float64 x</span><br><span class="line">    float64 y</span><br><span class="line">    float64 z</span><br><span class="line">  geometry_msgs/Quaternion rotation</span><br><span class="line">    float64 x</span><br><span class="line">    float64 y</span><br><span class="line">    float64 z</span><br><span class="line">    float64 w</span><br></pre></td></tr></table></figure>

<ul>
<li><code>geometry_msgs/PointStamped</code>用于传输某个坐标系内坐标点的信息</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">std_msgs/Header header</span><br><span class="line">  uint32 seq</span><br><span class="line">  time stamp</span><br><span class="line">  string frame_id</span><br><span class="line">geometry_msgs/Point point</span><br><span class="line">  float64 x</span><br><span class="line">  float64 y</span><br><span class="line">  float64 z</span><br></pre></td></tr></table></figure>



<p>在坐标变换中，频繁的需要使用到坐标系的相对关系以及坐标点信息。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看两种消息类型</span></span><br><span class="line">rosmsg info geometry_msgs/TransformStamped</span><br><span class="line">rosmsg info geometry_msgs/PointStamped</span><br></pre></td></tr></table></figure>

<p>（2）静态坐标变换</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#创建功能包</span></span><br><span class="line">依赖有： tf2、tf2_ros、tf2_geometry_msgs、roscpp rospy std_msgs geometry_msgs</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Publisher实现</span></span><br><span class="line"><span class="comment">#发布两个坐标系关系</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1.导包</span></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">import</span> tf2_ros</span><br><span class="line"><span class="keyword">import</span> tf     <span class="comment">#将欧拉角转换为四元数</span></span><br><span class="line"><span class="keyword">from</span> geometry_msgs.msg <span class="keyword">import</span> TransformStamped</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment"># 2.初始化 ROS 节点</span></span><br><span class="line">    rospy.init_node(<span class="string">&quot;static_tf_pub_p&quot;</span>)</span><br><span class="line">    <span class="comment"># 3.创建 静态坐标广播器</span></span><br><span class="line">    broadcaster = tf2_ros.StaticTransformBroadcaster()</span><br><span class="line">    <span class="comment"># 4.创建并组织发布的消息</span></span><br><span class="line">    tfs = TransformStamped()</span><br><span class="line">    <span class="comment"># --- 头信息Header  （这些都与消息类型有关）</span></span><br><span class="line">    tfs.header.frame_id = <span class="string">&quot;base_link&quot;</span></span><br><span class="line">    tfs.header.stamp = rospy.Time.now()</span><br><span class="line">    tfs.header.seq = <span class="number">101</span></span><br><span class="line">    <span class="comment"># --- 子坐标系</span></span><br><span class="line">    tfs.child_frame_id = <span class="string">&quot;radar&quot;</span></span><br><span class="line">    <span class="comment"># --- 坐标系相对信息</span></span><br><span class="line">    <span class="comment"># ------ 偏移量  (平移量)</span></span><br><span class="line">    tfs.transform.translation.x = <span class="number">0.2</span></span><br><span class="line">    tfs.transform.translation.y = <span class="number">0.0</span></span><br><span class="line">    tfs.transform.translation.z = <span class="number">0.5</span></span><br><span class="line">    <span class="comment"># ------ 四元数  (角度偏转量，四元数是一个较难的概念，需要就查)</span></span><br><span class="line">    qtn = tf.transformations.quaternion_from_euler(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>)   <span class="comment">#先从欧拉角转换为四元数</span></span><br><span class="line">    tfs.transform.rotation.x = qtn[<span class="number">0</span>]    <span class="comment">#再设置四元数</span></span><br><span class="line">    tfs.transform.rotation.y = qtn[<span class="number">1</span>]</span><br><span class="line">    tfs.transform.rotation.z = qtn[<span class="number">2</span>]</span><br><span class="line">    tfs.transform.rotation.w = qtn[<span class="number">3</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 5.广播器发送消息</span></span><br><span class="line">    broadcaster.sendTransform(tfs)</span><br><span class="line">    <span class="comment"># 6.spin</span></span><br><span class="line">    rospy.spin()</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Subcriber实现</span></span><br><span class="line"><span class="comment"># 1.导包</span></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">import</span> tf2_ros</span><br><span class="line"><span class="comment"># 不要使用 geometry_msgs,需要使用 tf2 内置的消息类型</span></span><br><span class="line"><span class="keyword">from</span> tf2_geometry_msgs <span class="keyword">import</span> PointStamped</span><br><span class="line"><span class="comment"># from geometry_msgs.msg import PointStamped</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment"># 2.初始化 ROS 节点</span></span><br><span class="line">    rospy.init_node(<span class="string">&quot;static_sub_tf_p&quot;</span>)</span><br><span class="line">    <span class="comment"># 3.创建 TF 订阅对象</span></span><br><span class="line">    buffer = tf2_ros.Buffer()   <span class="comment">#3.1缓存对象</span></span><br><span class="line">    listener = tf2_ros.TransformListener(buffer)  <span class="comment">#3.2订阅对象</span></span><br><span class="line"></span><br><span class="line">    rate = rospy.Rate(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> rospy.is_shutdown():    </span><br><span class="line">    <span class="comment"># 4.创建一个 radar 坐标系中的坐标点（等待被转换的坐标点）</span></span><br><span class="line">        point_source = PointStamped()</span><br><span class="line">        point_source.header.frame_id = <span class="string">&quot;radar&quot;</span></span><br><span class="line">        point_source.header.stamp = rospy.Time.now()</span><br><span class="line">        point_source.point.x = <span class="number">10</span>  <span class="comment">#被转换的坐标点必须已知</span></span><br><span class="line">        point_source.point.y = <span class="number">2</span></span><br><span class="line">        point_source.point.z = <span class="number">3</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">    <span class="comment">#     5.用buffer中转换函数，完成坐标转换！</span></span><br><span class="line">            point_target = buffer.transform(point_source,<span class="string">&quot;base_link&quot;</span>)   <span class="comment">#缓存buffer中有转换的方法</span></span><br><span class="line">                                                                                                                                <span class="comment">#参数：待转换的坐标点、目标坐标系</span></span><br><span class="line">            rospy.loginfo(<span class="string">&quot;转换结果:x = %.2f, y = %.2f, z = %.2f&quot;</span>,</span><br><span class="line">                            point_target.point.x,</span><br><span class="line">                            point_target.point.y,</span><br><span class="line">                            point_target.point.z)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            rospy.logerr(<span class="string">&quot;异常:%s&quot;</span>,e)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#     6.spin</span></span><br><span class="line">        rate.sleep()</span><br></pre></td></tr></table></figure>

<ul>
<li>拓：静态坐标系的实现流程很固定，所以ROS也考虑到这一点，为我们<strong>封装好了专门的节点</strong>——实现静态坐标变换</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#rosrun tf2_ros static_transform_publisher x偏移量 y偏移量 z偏移量 z偏航角度 y俯仰角度 x翻滚角度 父级坐标系 子级坐标系</span></span><br><span class="line">rosrun tf2_ros static_transform_publisher <span class="number">0.2</span> <span class="number">0</span> <span class="number">0.5</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> /baselink /laser</span><br></pre></td></tr></table></figure>

<ul>
<li>拓：在rviz中显示坐标系关系：</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#操作流程：</span></span><br><span class="line">   新建窗口输入命令:rviz;</span><br><span class="line">   在启动的 rviz 中设置Fixed Frame 为 base_link;</span><br><span class="line">   点击左下的 add 按钮，在弹出的窗口中选择 TF 组件，即可显示坐标关系。</span><br></pre></td></tr></table></figure>



<p>（3）动态坐标变换</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#创建功能包</span></span><br><span class="line">依赖有： tf2、tf2_ros、tf2_geometry_msgs、roscpp rospy std_msgs geometry_msgs、turtlesim</span><br></pre></td></tr></table></figure>

<p><strong>解释下面这段代码的思路：</strong></p>
<p>1.在Publisher节点中创建subscriber订阅话题<code>/turtle1/pose</code>（消息类型为<code>Pose</code>，回调函数为<code>doPose</code>）</p>
<p>2.在回调函数中处理消息，父系<code>world</code>，子系<code>turtle1</code>；通过**TransformStamped对象 (geometry_msgs.msg库)**的方法得到转换关系：3偏移量+四元数</p>
<p>3.通过<strong>TransformBroadcaster对象 (tf2_ros库)<strong>将转换关系广播（</strong>发布到TF中</strong>，在rviz中添加TF可以直接看到已经发布的信息）。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Publisher：负责订阅乌龟位姿信息，转换成坐标系的相对关系，再发布</span></span><br><span class="line"><span class="comment">#（由于乌龟坐标不再是静态的，所以需要发布方节点实时读取，才能找到坐标关系进行发布）</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1.导包</span></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">import</span> tf2_ros</span><br><span class="line"><span class="keyword">import</span> tf</span><br><span class="line"><span class="keyword">from</span> turtlesim.msg <span class="keyword">import</span> Pose</span><br><span class="line"><span class="keyword">from</span> geometry_msgs.msg <span class="keyword">import</span> TransformStamped</span><br><span class="line"></span><br><span class="line"><span class="comment">#     4.回调函数处理</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">doPose</span>(<span class="params">pose</span>):</span></span><br><span class="line">    <span class="comment">#         4-1.创建 TF 广播器</span></span><br><span class="line">    broadcaster = tf2_ros.TransformBroadcaster()</span><br><span class="line">    <span class="comment">#         4-2.创建 广播的数据(通过 pose 设置)，发布坐标系相对关系</span></span><br><span class="line">    tfs = TransformStamped()</span><br><span class="line">    tfs.header.frame_id = <span class="string">&quot;world&quot;</span></span><br><span class="line">    tfs.header.stamp = rospy.Time.now()</span><br><span class="line">    tfs.child_frame_id = <span class="string">&quot;turtle1&quot;</span></span><br><span class="line">    tfs.transform.translation.x = pose.x   <span class="comment">#偏移量</span></span><br><span class="line">    tfs.transform.translation.y = pose.y</span><br><span class="line">    tfs.transform.translation.z = <span class="number">0.0</span></span><br><span class="line">    qtn = tf.transformations.quaternion_from_euler(<span class="number">0</span>,<span class="number">0</span>,pose.theta)   <span class="comment">#四元数</span></span><br><span class="line">                                                                        <span class="comment">#乌龟是2D运动，不存在X、Y上的偏角，只有Z上的偏航，所以传pose.theta即可</span></span><br><span class="line">    tfs.transform.rotation.x = qtn[<span class="number">0</span>]</span><br><span class="line">    tfs.transform.rotation.y = qtn[<span class="number">1</span>]</span><br><span class="line">    tfs.transform.rotation.z = qtn[<span class="number">2</span>]</span><br><span class="line">    tfs.transform.rotation.w = qtn[<span class="number">3</span>]</span><br><span class="line">    <span class="comment">#         4-3.广播器发布数据</span></span><br><span class="line">    broadcaster.sendTransform(tfs)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment"># 2.初始化 ROS 节点</span></span><br><span class="line">    rospy.init_node(<span class="string">&quot;dynamic_tf_pub_p&quot;</span>)</span><br><span class="line">    <span class="comment"># 3.创建订阅对象，订阅 /turtle1/pose 话题消息</span></span><br><span class="line">    sub = rospy.Subscriber(<span class="string">&quot;/turtle1/pose&quot;</span>,Pose,doPose)</span><br><span class="line">    <span class="comment">#     4.回调函数处理</span></span><br><span class="line">    <span class="comment">#         4-1.创建 TF 广播器</span></span><br><span class="line">    <span class="comment">#         4-2.创建 广播的数据(通过 pose 设置)</span></span><br><span class="line">    <span class="comment">#         4-3.广播器发布数据</span></span><br><span class="line">    <span class="comment">#     5.spin</span></span><br><span class="line">    rospy.spin()</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Subscriber：与静态几乎一致</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1.导包</span></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">import</span> tf2_ros</span><br><span class="line"><span class="comment"># 不要使用 geometry_msgs,需要使用 tf2 内置的消息类型</span></span><br><span class="line"><span class="keyword">from</span> tf2_geometry_msgs <span class="keyword">import</span> PointStamped</span><br><span class="line"><span class="comment"># from geometry_msgs.msg import PointStamped</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment"># 2.初始化 ROS 节点</span></span><br><span class="line">    rospy.init_node(<span class="string">&quot;static_sub_tf_p&quot;</span>)</span><br><span class="line">    <span class="comment"># 3.创建 TF 订阅对象</span></span><br><span class="line">    buffer = tf2_ros.Buffer()</span><br><span class="line">    listener = tf2_ros.TransformListener(buffer)</span><br><span class="line"></span><br><span class="line">    rate = rospy.Rate(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> rospy.is_shutdown():    </span><br><span class="line">    <span class="comment"># 4.创建一个 radar 坐标系中的坐标点</span></span><br><span class="line">        point_source = PointStamped()</span><br><span class="line">        point_source.header.frame_id = <span class="string">&quot;turtle1&quot;</span></span><br><span class="line">        point_source.header.stamp = rospy.Time.now()</span><br><span class="line">        point_source.point.x = <span class="number">10</span></span><br><span class="line">        point_source.point.y = <span class="number">2</span></span><br><span class="line">        point_source.point.z = <span class="number">3</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">    <span class="comment">#     5.调研订阅对象的 API 将 4 中的点坐标转换成相对于 world 的坐标</span></span><br><span class="line">            point_target = buffer.transform(point_source,<span class="string">&quot;world&quot;</span>,rospy.Duration(<span class="number">1</span>))  <span class="comment">#缓存buffer中有转换的方法</span></span><br><span class="line">            rospy.loginfo(<span class="string">&quot;转换结果:x = %.2f, y = %.2f, z = %.2f&quot;</span>,</span><br><span class="line">                            point_target.point.x,</span><br><span class="line">                            point_target.point.y,</span><br><span class="line">                            point_target.point.z)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            rospy.logerr(<span class="string">&quot;异常:%s&quot;</span>,e)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#     6.spin</span></span><br><span class="line">        rate.sleep()</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/04/17/%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0ROS%EF%BC%88%E4%BA%8C%EF%BC%89/" data-id="cknlaol4g00006gt9d9qheu9r" data-title="系统学习ROS（二）" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2021/04/17/%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0ROS%EF%BC%88%E4%B8%89%EF%BC%89/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          系统学习ROS（三）
        
      </div>
    </a>
  
  
    <a href="/2021/04/14/%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0ROS%EF%BC%88%E4%B8%80%EF%BC%89/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">系统学习ROS（一）</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Deep-Learning-Objects-Detection/">Deep Learning-Objects Detection</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Git/">Git</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Others/">Others</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/ROS/">ROS</a></li></ul>
    </div>
  </div>


  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">May 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">April 2021</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/05/11/github%EF%BC%9A%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE%E5%AF%BB%E6%89%BE%E9%80%94%E5%BE%84/">github：开源项目寻找途径</a>
          </li>
        
          <li>
            <a href="/2021/04/17/%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0ROS%EF%BC%9A%E9%97%AE%E9%A2%98%E7%AF%871/">系统学习ROS：问题篇1</a>
          </li>
        
          <li>
            <a href="/2021/04/17/%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0ROS%EF%BC%88%E4%B8%89%EF%BC%89/">系统学习ROS（三）</a>
          </li>
        
          <li>
            <a href="/2021/04/17/%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0ROS%EF%BC%88%E4%BA%8C%EF%BC%89/">系统学习ROS（二）</a>
          </li>
        
          <li>
            <a href="/2021/04/14/%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0ROS%EF%BC%88%E4%B8%80%EF%BC%89/">系统学习ROS（一）</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2021 Eric Tan<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>